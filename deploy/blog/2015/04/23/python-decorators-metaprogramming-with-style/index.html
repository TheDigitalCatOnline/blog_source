<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>The Digital Cat - Python decorators: metaprogramming with style</title>
    <meta charset="utf-8" />
    <meta http-equiv='content-language' content='en-gb'>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="A blog featuring in-depth posts about Python, Scala, TDD, devops, security and all things development">
<meta name="description" content="Python decorators: metaprogramming with style">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@thedigicat" />
<meta name="twitter:title" content="Python decorators: metaprogramming with style" />
<meta name="twitter:description" content="Read the full post on The Digital Cat" />
<meta name="twitter:image" content="https://www.thedigitalcatonline.com/images/python-decorators-metaprogramming-with-style.jpg" />
    <script src="https://kit.fontawesome.com/15214b60ba.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;1,400;1,600&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="/theme/css/main.min.css?63e1c1d2">
    <link href="/images/global/favicon.jpg" rel="icon">
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74364524-1"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     
     gtag('config', 'UA-74364524-1');
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ55XG1KGG"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     
     gtag('config', 'G-FZ55XG1KGG');
    </script>
  </head>

  <body class="preload">
    <div class="container">
      <div class="sidebar navigation">
<nav>
<div class="links">
  <ul>
    <li class="link"><a href="/index.html">Homepage</a></li>
    <li class="link"><a href="/pages/about.html">About</a></li>
    <li class="link"><a href="/archives/index.html">Archives</a></li>
  </ul>
</div></nav>
<section>
  <header>
    <h2>Categories</h2>
  </header>
<ul>
  <li><a href="/category/programming/">Programming</a></li>
  <li><a href="/category/projects/">Projects</a></li>
  <li><a href="/category/retro/">Retro</a></li>
</ul></section>
<section>
  <header>
    <h2>Feeds</h2>
  </header>
<ul>
  <li><i class="fas fa-rss" aria-hidden="true"></i> <a href="/atom.xml">All posts</a></li>


  <li><i class="fas fa-rss" aria-hidden="true"></i> <a href="/category/programming/atom.xml">All posts in category: Programming</a></li>
</ul></section>
<section>
  <header>
    <h2>Tags</h2>
  </header>
<ul class="tags">
    <li class="tag tag-size-3">
      <a title="Posts about algorithms" href="/categories/algorithms/">algorithms</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about amiga" href="/categories/amiga/">amiga</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about AMQP" href="/categories/amqp/">AMQP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about architectures" href="/categories/architectures/">architectures</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about assembly" href="/categories/assembly/">assembly</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about AWS" href="/categories/aws/">AWS</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about blogging" href="/categories/blogging/">blogging</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about C" href="/categories/c/">C</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Clojure" href="/categories/clojure/">Clojure</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about compilers" href="/categories/compilers/">compilers</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about concurrent programming" href="/categories/concurrent-programming/">concurrent programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about cryptography" href="/categories/cryptography/">cryptography</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about decorators" href="/categories/decorators/">decorators</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about design" href="/categories/design/">design</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about devops" href="/categories/devops/">devops</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Django" href="/categories/django/">Django</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Docker" href="/categories/docker/">Docker</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about ed25519" href="/categories/ed25519/">ed25519</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about editor" href="/categories/editor/">editor</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Emacs" href="/categories/emacs/">Emacs</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Erlang" href="/categories/erlang/">Erlang</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Flask" href="/categories/flask/">Flask</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about functional programming" href="/categories/functional-programming/">functional programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about generators" href="/categories/generators/">generators</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Git" href="/categories/git/">Git</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about HTML" href="/categories/html/">HTML</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about HTTP" href="/categories/http/">HTTP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about infrastructure" href="/categories/infrastructure/">infrastructure</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about JavaScript" href="/categories/javascript/">JavaScript</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Lambda" href="/categories/lambda/">Lambda</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about M68000" href="/categories/m68000/">M68000</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Markdown" href="/categories/markdown/">Markdown</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Mau" href="/categories/mau/">Mau</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaclasses" href="/categories/metaclasses/">metaclasses</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaprogramming" href="/categories/metaprogramming/">metaprogramming</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Notebook" href="/categories/notebook/">Notebook</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about OOP" href="/categories/oop/">OOP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about operating systems" href="/categories/operating-systems/">operating systems</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about pelican" href="/categories/pelican/">pelican</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Pika" href="/categories/pika/">Pika</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Postage" href="/categories/postage/">Postage</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Postgres" href="/categories/postgres/">Postgres</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about pytest" href="/categories/pytest/">pytest</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python" href="/categories/python/">Python</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Python2" href="/categories/python2/">Python2</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python3" href="/categories/python3/">Python3</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about RabbitMQ" href="/categories/rabbitmq/">RabbitMQ</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about refactoring" href="/categories/refactoring/">refactoring</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about retroprogramming" href="/categories/retroprogramming/">retroprogramming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about RSA" href="/categories/rsa/">RSA</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Scala" href="/categories/scala/">Scala</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSH" href="/categories/ssh/">SSH</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSL" href="/categories/ssl/">SSL</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about TDD" href="/categories/tdd/">TDD</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Terraform" href="/categories/terraform/">Terraform</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about testing" href="/categories/testing/">testing</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about tools" href="/categories/tools/">tools</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about versioning" href="/categories/versioning/">versioning</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about video" href="/categories/video/">video</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about WWW" href="/categories/www/">WWW</a>
    </li>
</ul></section>
<section>
  <header>
    <h2>Get in touch</h2>
  </header>
  <ul class="contact">
    <li><i class="fab fa-twitter" aria-hidden="true"></i> <a href="https://twitter.com/thedigicat">Twitter</a></li>
    <li><i class="fab fa-github" aria-hidden="true"></i> <a href="https://github.com/TheDigitalCatOnline">GitHub</a></li>
  </ul>
</section>      </div>
      <div class="page">
	<header class="primary" >
	  <button type="button">
	    <i class="fas fa-bars"></i>
	  </button>
	  <p>The Digital Cat</p>
	</header>
	<div class="mobile-menu navigation">
<nav>
<div class="links">
  <ul>
    <li class="link"><a href="/index.html">Homepage</a></li>
    <li class="link"><a href="/pages/about.html">About</a></li>
    <li class="link"><a href="/archives/index.html">Archives</a></li>
  </ul>
</div></nav>
<section>
  <header>
    <h2>Categories</h2>
  </header>
<ul>
  <li><a href="/category/programming/">Programming</a></li>
  <li><a href="/category/projects/">Projects</a></li>
  <li><a href="/category/retro/">Retro</a></li>
</ul></section>
<section>
  <header>
    <h2>Tags</h2>
  </header>
<ul class="tags">
    <li class="tag tag-size-3">
      <a title="Posts about algorithms" href="/categories/algorithms/">algorithms</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about amiga" href="/categories/amiga/">amiga</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about AMQP" href="/categories/amqp/">AMQP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about architectures" href="/categories/architectures/">architectures</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about assembly" href="/categories/assembly/">assembly</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about AWS" href="/categories/aws/">AWS</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about blogging" href="/categories/blogging/">blogging</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about C" href="/categories/c/">C</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Clojure" href="/categories/clojure/">Clojure</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about compilers" href="/categories/compilers/">compilers</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about concurrent programming" href="/categories/concurrent-programming/">concurrent programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about cryptography" href="/categories/cryptography/">cryptography</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about decorators" href="/categories/decorators/">decorators</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about design" href="/categories/design/">design</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about devops" href="/categories/devops/">devops</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Django" href="/categories/django/">Django</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Docker" href="/categories/docker/">Docker</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about ed25519" href="/categories/ed25519/">ed25519</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about editor" href="/categories/editor/">editor</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Emacs" href="/categories/emacs/">Emacs</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Erlang" href="/categories/erlang/">Erlang</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Flask" href="/categories/flask/">Flask</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about functional programming" href="/categories/functional-programming/">functional programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about generators" href="/categories/generators/">generators</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Git" href="/categories/git/">Git</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about HTML" href="/categories/html/">HTML</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about HTTP" href="/categories/http/">HTTP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about infrastructure" href="/categories/infrastructure/">infrastructure</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about JavaScript" href="/categories/javascript/">JavaScript</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Lambda" href="/categories/lambda/">Lambda</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about M68000" href="/categories/m68000/">M68000</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Markdown" href="/categories/markdown/">Markdown</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Mau" href="/categories/mau/">Mau</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaclasses" href="/categories/metaclasses/">metaclasses</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaprogramming" href="/categories/metaprogramming/">metaprogramming</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Notebook" href="/categories/notebook/">Notebook</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about OOP" href="/categories/oop/">OOP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about operating systems" href="/categories/operating-systems/">operating systems</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about pelican" href="/categories/pelican/">pelican</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Pika" href="/categories/pika/">Pika</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Postage" href="/categories/postage/">Postage</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Postgres" href="/categories/postgres/">Postgres</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about pytest" href="/categories/pytest/">pytest</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python" href="/categories/python/">Python</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Python2" href="/categories/python2/">Python2</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python3" href="/categories/python3/">Python3</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about RabbitMQ" href="/categories/rabbitmq/">RabbitMQ</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about refactoring" href="/categories/refactoring/">refactoring</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about retroprogramming" href="/categories/retroprogramming/">retroprogramming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about RSA" href="/categories/rsa/">RSA</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Scala" href="/categories/scala/">Scala</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSH" href="/categories/ssh/">SSH</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSL" href="/categories/ssl/">SSL</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about TDD" href="/categories/tdd/">TDD</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Terraform" href="/categories/terraform/">Terraform</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about testing" href="/categories/testing/">testing</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about tools" href="/categories/tools/">tools</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about versioning" href="/categories/versioning/">versioning</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about video" href="/categories/video/">video</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about WWW" href="/categories/www/">WWW</a>
    </li>
</ul></section>	</div>
	
<div class="page-content">
  <header>
    <h1>Python decorators: metaprogramming with style</h1>
    <div class="post-info">
      <p>By Leonardo Giordani - <i class="fas fa-calendar-alt"></i> <time datetime="2015-04-23T13:00:00+01:00"> 23/04/2015</time></p>
      <p class="tags">
	<a class="tag category" href="/category/programming/" title="All posts in category Programming">Programming</a>
	<a class="tag" href="/categories/decorators/">decorators</a>
	<a class="tag" href="/categories/functional-programming/">functional programming</a>
	<a class="tag" href="/categories/metaprogramming/">metaprogramming</a>
	<a class="tag" href="/categories/oop/">OOP</a>
	<a class="tag" href="/categories/python/">Python</a>
      </p>
      <p class="share">Share on: <span><a class="" href="https://twitter.com/intent/tweet?text=Python%20decorators%3A%20metaprogramming%20with%20style&url=https%3A//www.thedigitalcatonline.com/blog/2015/04/23/python-decorators-metaprogramming-with-style/&via=thedigicat&hashtags=decorators,functional-programming,metaprogramming,oop,python" target="_blank" title="Share on Twitter"><i class="fab fa-twitter"></i> Twitter</a></span>
<span><a class="" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//www.thedigitalcatonline.com/blog/2015/04/23/python-decorators-metaprogramming-with-style/&title=Python%20decorators%3A%20metaprogramming%20with%20style&summary=&source=https%3A//www.thedigitalcatonline.com/blog/2015/04/23/python-decorators-metaprogramming-with-style/" target="_blank" title="Share on LinkedIn"><i class="fab fa-linkedin"></i> LinkedIn</a></span>
<span><a class="" href="https://news.ycombinator.com/submitlink?t=Python%20decorators%3A%20metaprogramming%20with%20style&u=https%3A//www.thedigitalcatonline.com/blog/2015/04/23/python-decorators-metaprogramming-with-style/" target="_blank" title="Share on HackerNews"><i class="fab fa-hacker-news"></i> HackerNews</a></span>
<span><a class="" href="mailto:?subject=Python%20decorators%3A%20metaprogramming%20with%20style&amp;body=https%3A//www.thedigitalcatonline.com/blog/2015/04/23/python-decorators-metaprogramming-with-style/" target="_blank" title="Share via Email"><i class="fas fa-envelope"></i> Email</a></span>
<span><a class="" href="https://www.reddit.com/submit?url=https%3A//www.thedigitalcatonline.com/blog/2015/04/23/python-decorators-metaprogramming-with-style/&title=Python%20decorators%3A%20metaprogramming%20with%20style" target="_blank" title="Share via Reddit"><i class="fab fa-reddit"></i> Reddit</a></span></p>    
    </div>
  </header>
  
  <div class="post-content">
    <p>This post is the result of a lot of personal research on Python decorators, meta- and functional programming. I want however to thank Bruce Eckel and the people behind the open source book "Python 3 Patterns, Recipes and Idioms" for a lot of precious information on the subject. See the Resources section at the end of the post to check their work.</p>
<h2 id="is-python-functional">Is Python functional?<a class="headerlink" href="#is-python-functional" title="Permanent link">&para;</a></h2>
<p>Well, no. Python is a strong object-oriented programming language and is not really going to mix OOP and functional like, for example, Scala (which is a very good language, by the way).</p>
<p>However, Python provides <em>some</em> features taken from functional programming. <a href="https://www.thedigitalcatonline.com/blog/2013/03/25/python-generators-from-iterators-to-cooperative-multitasking/">Generators and iterators</a> are one of them, and Python is not the only non pure functional programming language to have them in their toolbox.</p>
<p>Perhaps the most distinguishing feature of <a href="https://en.wikipedia.org/wiki/Functional_programming">functional languages</a> is that functions are first-class citizens (or first-class objects). This means that functions can be passed as an argument to other functions or can be returned by them. Functions, in functional languages, are just one of the data types available (even if this is a very rough simplification).</p>
<p>Python has three important features that allows it to provide a functional behaviour: references, function objects and callables.</p>
<h3 id="references">References<a class="headerlink" href="#references" title="Permanent link">&para;</a></h3>
<p>Python variables share a common nature: they are all references. This means that variables are not typed per se, being pure memory addresses, and that functions do not declare the incoming data type for arguments (leaving aside gradual typing). Python polymorphism is based on delegation, and incoming function arguments are expected to provide a given behaviour, not a given structure.</p>
<p>Python functions are thus ready to accept every type of data that can be referenced, and functions can.</p>
<p>Read <a href="https://www.thedigitalcatonline.com/blog/2014/08/21/python-3-oop-part-4-polymorphism/">this post</a> to dive into delegation-based polymorphism and references in Python.</p>
<h2 id="functions-objects">Functions objects<a class="headerlink" href="#functions-objects" title="Permanent link">&para;</a></h2>
<p>Since Python pushes the object-oriented paradigm to its maximum, it makes a point of always following the tenet <em>everything is an object</em>. So Python functions are objects as you can see from this simple example</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="go">&lt;class &#39;function&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="go">&lt;class &#39;type&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="vm">__bases__</span>
<span class="go">(&lt;class &#39;object&#39;&gt;,)</span>
<span class="go">&gt;&gt;&gt;</span>
</code></pre></div>

<p>Given that, Python does nothing special to treat functions like first-class citizens, it simply recognizes that they are objects just like any other thing.</p>
<h3 id="callables">Callables<a class="headerlink" href="#callables" title="Permanent link">&para;</a></h3>
<p>While Python has the well-defined <code>function</code> class seen in the above example, it relies more on the presence of the <code>__call__</code> method. That is, in Python any object can act as a function, provided that it has this method, which is invoked when the object is "called".</p>
<p>This will be crucial for the discussion about decorators, so be sure that you remember that we are usually more interested in <em>callable objects</em> and not only in functions, which, obviously, are a particular type of callable objects (or simply <em>callables</em>).</p>
<p>The fact that functions are callables can also be shown with some simple code</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">():</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">f</span><span class="o">.</span><span class="fm">__call__</span>
<span class="go">&lt;method-wrapper &#39;__call__&#39; of function object at 0xb6709fa4&gt;</span>
</code></pre></div>

<h2 id="metaprogramming">Metaprogramming<a class="headerlink" href="#metaprogramming" title="Permanent link">&para;</a></h2>
<p>While this is not a post on languages theory, it is worth spending a couple of words about metaprogramming. Usually "programming" can be seen as the task of applying transformations to data. Data and functions can be put together by an object-oriented approach, but they still are two different things. But you soon realize that, as you may run some code to change data, you may also run some code to change the code itself.</p>
<p>In low level languages this can be very simple, since at machine level everything is a sequence of bytes, and changing data or code does not make any difference. One of the most simple examples that I recall from my x86 Assembly years is the very simple self obfuscation code found is some computer viruses. The code was encrypted with a <a href="https://en.wikipedia.org/wiki/XOR_cipher">XOR cipher</a> and the first thing the code itself did upon execution was to decrypt its own code and then run it. The purpose of such tricks was (and is) to obfuscate the code such that it would be difficult for an antivirus to find the virus code and remove it. This is a very primitive form of metaprogramming, since it recognizes that for Assembly language there is no real distinction between code and data.</p>
<p>In higher lever languages such as Python achieving metaprogramming is no more a matter of changing byte values. It requires the language to treat its own structures as data. Every time we are trying to alter the behaviour of a language part we are actually metaprogramming. The first example that usually comes to mind are metaclasses (probably due to the "meta" word in their name), which are actually a way to change the default behaviour of the class creation process. Classes (part of the language) are created by another part of the language (metaclasses).</p>
<h2 id="decorators">Decorators<a class="headerlink" href="#decorators" title="Permanent link">&para;</a></h2>
<p><a href="https://www.thedigitalcatonline.com/blog/2014/09/01/python-3-oop-part-5-metaclasses/">Metaclasses</a> are often perceived as a very tricky and dangerous thing to play with, and indeed they are seldom required in Python, with the most notable exception (no pun intended) being the <a href="https://www.thedigitalcatonline.com/blog/2014/09/04/python-3-oop-part-6-abstract-base-classes/">Abstract Base Classes</a> provided by the <code>collections</code> module.</p>
<p>Decorators, on the other side, are a feature loved by many experienced programmers and after their introduction the community has developed a big set of very interesting use cases.</p>
<p>I think that the first approach to decorators is often difficult for beginners because the functional version of decorators are indeed a bit complex to understand. Luckily, Python allows us to write decorators using classes too, which make the whole thing really easy to understand and write, I think.</p>
<p>So I will now review Python decorators starting from their rationale, then looking at class-based decorators without arguments, class-based decorators with arguments, and finally moving to function-based decorators.</p>
<h2 id="rationale">Rationale<a class="headerlink" href="#rationale" title="Permanent link">&para;</a></h2>
<p>What are decorators, and why should you learn how to define and use them? </p>
<p>Well, decorators are a way to change the behaviour of a function or a class, so they are actually a way of metaprogramming, but they make it a lot more accessible than metaclasses do. Decorators are, in my opinion, a very <em>natural</em> way of altering functions and classes.</p>
<p>Moreover, with the addition of some syntactic sugar, they are a very compact way to both make changes and signal that those changes have been made.</p>
<p>The best syntactic form of a decorator is the following</p>
<div class="highlight"><pre><span></span><code><span class="nd">@dec</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>

<p>where <code>dec</code> is the name of the decorator and the function <code>func</code> is said to be <em>decorated</em> by it. As you can see any reader can quickly identify that the function has a special label attached, thus being altered in its behaviour.</p>
<p>This form, however, is just a simplification of the more generic form</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="n">func</span> <span class="o">=</span> <span class="n">dec</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</code></pre></div>

<p>But what actually ARE the changes that you may want do to functions or classes? Let us stick for the moment to a very simple task: adding attributes. This is by no means a meaningless task, since there are many practical use cases that make use of it. Let us first test how we can add attributes to functions in plain Python</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;a custom function attribute&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span><span class="o">.</span><span class="n">attr</span>
<span class="go">&#39;a custom function attribute&#39;</span>
</code></pre></div>

<p>and to classes</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SomeClass</span><span class="p">:</span>
<span class="gp">... </span> <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SomeClass</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;a custom class attribute&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">SomeClass</span><span class="o">.</span><span class="n">attr</span>
<span class="go">&#39;a custom class attribute&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SomeClass</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">attr</span>
<span class="go">&#39;a custom class attribute&#39;</span>
</code></pre></div>

<p>As you can see adding attributes to a class correctly results in a class attribute, which is thus shared by any instance of that class (check <a href="https://www.thedigitalcatonline.com/blog/2014/08/20/python-3-oop-part-2-classes-and-members/">this post</a> for some explanations about class attributes and sharing).</p>
<h2 id="class-based-decorators-without-arguments">Class-based decorators without arguments<a class="headerlink" href="#class-based-decorators-without-arguments" title="Permanent link">&para;</a></h2>
<p>As already explained, Python allows you to call any object (as you do with functions) as long as it provides the <code>__call__()</code> method. So to write a class-based decorator you just need to create an object that defines such a method.</p>
<p>When used as a decorator, a class is instantiated at decoration time, that is when the function is defined, and called when the function is called.</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CustomAttr</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;a custom function attribute&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span> <span class="o">=</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">obj</span><span class="p">()</span>
</code></pre></div>

<p>As you can see there is already a lot of things that shall be clarified. First of all the class, when used as a decorator, is initialized with the object that is going to be decorated, here called <code>obj</code> (most of the time it is just called <code>f</code> for function, but you know that this is only a special case).</p>
<p>While the <code>__init__()</code> method is called at decoration time, the <code>__call__()</code> method of the decorator is called instead of the same method of the decorated object. In this case (decorator without arguments), the <code>__call__()</code> method of the decorator does not receive any argument. In this example we just "redirect" the call to the original function, which was stored during the initialization step.</p>
<p>So you see that in this case we have two different moments in which we may alter the behaviour of the decorated objects. The first is at its definition and the second is when it is actually called.</p>
<p>The decorator can be applied with the simple syntax shown in a previous section</p>
<div class="highlight"><pre><span></span><code><span class="nd">@CustomAttr</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>When Python parses the file and defines the function <code>func</code> the code it executes under the hood is</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="n">func</span> <span class="o">=</span> <span class="n">CustomAttr</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</code></pre></div>

<p>according to the definition of decorator. This is why the class shall accept the decorated object as a parameter in its <code>__init__()</code> method.</p>
<p>Note that in this case the <code>func</code> object we obtain after the decoration is no more a function but a <code>CustomAttr</code> object</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">func</span>
<span class="go">&lt;__main__.CustomAttr object at 0xb6f5ea8c&gt;</span>
</code></pre></div>

<p>and this is why in the <code>__init__()</code> method I attached the <code>attr</code> attribute to the class instance <code>self</code> and not to <code>obj</code>, so that now this works</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">func</span><span class="o">.</span><span class="n">attr</span>
<span class="go">&#39;a custom function attribute&#39;</span>
</code></pre></div>

<p>This replacement is also the reason why you shall also redefine <code>__call__()</code>. When you write <code>func()</code> you are not executing the function but calling the instance of <code>CustomAttr</code> returned by the decoration.</p>
<h2 id="class-based-decorators-with-arguments">Class-based decorators with arguments<a class="headerlink" href="#class-based-decorators-with-arguments" title="Permanent link">&para;</a></h2>
<p>This case is the most natural step beyond the previous one. Once you started metaprogramming, you want to do it with style, and the first thing to do is to add parametrization. Adding parameters to decorators has the only purpose of generalizing the metaprogramming code, just like when you write parametrized functions instead of hardcoding values.</p>
<p>There is a big caveat here. Class-based decorators with arguments behave in a slightly different way to their counterpart without arguments. Specifically, the <code>__call__()</code> method is run during the decoration and not during the call.</p>
<p>Let us first review the syntax</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CustomAttrArg</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;a custom function attribute with value </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span>

<span class="nd">@CustomAttrArg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Now the <code>__init__()</code> method shall accept some arguments, with the standard rules of Python functions for named and default arguments. The <code>__call__()</code> method receives the decorated object, which in the previous case was passed to the <code>__init__()</code> method.</p>
<p>The biggest change, however is that <code>__call__()</code> is not run when you call the decorated object, but immediately after <code>__init__()</code> during the decoration phase. This results in the following difference: while in the previous case the decorated object was no more itself, but an instance of the decorator, now the decorated objects becomes the return value of the <code>__call__()</code> method.</p>
<p>Remember that, when you call the decorated object, you are now actually calling what you get from <code>__call__()</code> so be sure of returning something meaningful.</p>
<p>In the above example I stored one single argument in <code>__init__()</code>, and this argument is passed to the decorator when applying it to the function. Then, in <code>__call__()</code>, I set the attribute of the decorated object, using the stored argument, and return the object itself. This is important, since I have to return a callable object.</p>
<p>This means that, if you have to do something complex with the decorated object, you may just define a local function that makes use of it and return this function. Let us see a very simple example</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CustomAttrArg</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">wrap</span><span class="p">():</span>
            <span class="c1"># Here you can do complex stuff</span>
            <span class="n">obj</span><span class="p">()</span>
            <span class="c1"># Here you can do complex stuff</span>
        <span class="k">return</span> <span class="n">wrap</span>

<span class="nd">@CustomAttrArg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>Here the returned object is no more the decorated one, but a new function <code>wrap()</code> defined locally. It is interesting to show how Python identifies it</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="nd">@CustomAttrArg</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">... </span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">func</span>
<span class="go">&lt;function CustomAttrArg.__call__.&lt;locals&gt;.wrap at 0xb70185cc&gt;</span>
</code></pre></div>

<p>This pattern enables you to do every sort of things with the decorated object. Not only to change it (adding attributes, for example), but also pre- or post- filtering its results. You may start to understand that what we called metaprogramming may be very useful for everyday tasks, and not only for some obscure wizardry.</p>
<h3 id="decorators-and-prototypes">Decorators and prototypes<a class="headerlink" href="#decorators-and-prototypes" title="Permanent link">&para;</a></h3>
<p>If you write a class-based decorator with arguments, you are in charge of returning a callable object of choice. There is no assumption on the returned object, even if the usual case is that the returned object has the same prototype as the decorated one.</p>
<p>This means that if the decorated object accepts zero arguments (like in my example), you usually return a callable that accepts zero arguments. This is however by no means enforced by the language, and through this you may push the metaprogramming technique a bit. I'm not providing examples of this technique in this post, however.</p>
<h2 id="function-based-decorators">Function-based decorators<a class="headerlink" href="#function-based-decorators" title="Permanent link">&para;</a></h2>
<p>Function-based decorators are very simple for simple cases and a bit trickier for complex ones. The problem is that their syntax can be difficult to grasp at first sight if you never saw a decorator. They are indeed not very different from the class-based decorators with arguments case, as they define a local function that wraps the decorated object and return it.</p>
<p>The case without arguments is always the simplest one</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">():</span>
        <span class="n">f</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">wrap</span>

<span class="nd">@decorate</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre></div>

<p>This behaves like the equivalent case with classes. The function is passed as an argument to the <code>decorate()</code> function by the decoration process that calls it passing the decorated object. When you actually call the function, however, you are actually calling <code>wrap()</code>.</p>
<p>As happens for class-based decorators, the parametrization changes the calling procedure. This is the code</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_wrap</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="n">f</span><span class="p">(</span><span class="n">arg</span> <span class="o">+</span> <span class="n">arg1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_wrap</span>
    <span class="k">return</span> <span class="n">wrap</span>

<span class="nd">@decorate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="k">pass</span>
</code></pre></div>

<p>As you see it is not really straightforward, and this is the reason I preferred to discuss it as the last case. Recall what we learned about class-based decorators: the first call to the <code>decorate()</code> function happens when the decorator is called with an argument. Thus <code>@decorate(1)</code> calls <code>decorate()</code> passing <code>1</code> as <code>arg1</code>, and this function returns the <code>wrap()</code> local function.</p>
<p>This second function accepts another function as an argument, and indeed it is used in the actual decoration process, which can be represented by the code <code>func = wrap(func)</code>. This <code>wrap()</code> function, being used to decorate <code>func()</code>, wants to return a compatible object, that is in this case a function that accepts a single argument. This is why, in turn, <code>wrap()</code> defines and returns a <code>_wrap()</code> local function, which eventually uses both the argument passed to <code>func()</code> and the argument passed to the decorator.</p>
<p>So the process may be summarized as follows (I will improperly call <code>func_dec</code> the decorated function to show what is happening)</p>
<ul>
<li><code>@decorator(1)</code> returns a <code>wrap()</code> function (that knows the argument)</li>
<li><code>func</code> is redefined as <code>func_dec = wrap(func)</code> becoming <code>_wrap()</code></li>
<li>When you call <code>func_dec(arg)</code> Python executes <code>_wrap(arg)</code> which calls the original <code>func()</code> passing <code>1 + arg</code> as argument</li>
</ul>
<p>Obviously the power of the decorator concept is that you are not dealing with <code>func_dec()</code> but with <code>func()</code> itself, and all the "magic" happens under the hood.</p>
<p>If you feel uncomfortable with function-based decorators don't worry, as they are indeed a bit awkward. I usually stick to function based decorators for the simple cases (setting class attributes, for example), and move to class-based ones when the code is more complex.</p>
<h2 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h2>
<p>A good example of the power of decorators which comes out of the box is <code>functools.total_ordering</code>. The <code>functools</code> module provides a lot of interesting tools to push the functional approach in Python, most notably <code>partial()</code> and <code>partialmethod()</code>, which are however out of the scope of this post.</p>
<p>The <code>total_ordering</code> decorator (documented <a href="https://docs.python.org/3.4/library/functools.html#functools.total_ordering">here</a>) wants to make an object provide a full set of comparison ordering methods starting from a small set of them. Comparison methods are those methods Python calls when two objects are compared. For example when you write <code>a == b</code>, Python executes <code>a.__eq__(b)</code> and the same happens for the other five operators <code>&gt;</code> (<code>__gt__</code>), <code>&lt;</code> (<code>__lt__</code>), <code>&gt;=</code> (<code>__ge__</code>), <code>&lt;=</code> (<code>__le__</code>) and <code>!=</code> (<code>__ne__</code>).</p>
<p>Mathematically all those operators may be expressed using only one of them and the <code>__eq__()</code> method, for example <code>__ne__</code> is <code>!__eq__</code> and <code>__lt__</code> is <code>__le__ and !__eq__</code>. This decorator makes use of this fact to provide the missing methods for the decorated object. A quick example</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</code></pre></div>

<p>This is a simple class that defines the <code>==</code> and <code>&lt;</code> comparison methods.</p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">&lt;</span> <span class="n">p2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">&gt;=</span> <span class="n">p2</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;/home/leo/prova.py&quot;</span>, line <span class="m">103</span>, in <span class="n">&lt;module&gt;</span>
    <span class="n">p1</span> <span class="o">&gt;=</span> <span class="n">p2</span>
<span class="gr">TypeError</span>: <span class="n">unorderable types: Person() &gt;= Person()</span>
</code></pre></div>

<p>A big warning: Python doesn't complain if you try to perform the <code>&gt;</code> and <code>!=</code> comparisons but lacking the dedicated methods it does perform a "standard" comparison. This means that, as the documentation states <a href="https://docs.python.org/2/reference/datamodel.html#object.__lt__">here</a>, "There are no implied relationships among the comparison operators. The truth of x==y does not imply that x!=y is false."</p>
<p>With the <code>total_ordering</code> decorator, however, all six comparisons become available</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">functools</span>

<span class="nd">@functools</span><span class="o">.</span><span class="n">total_ordering</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p2</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">==</span> <span class="n">p2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">!=</span> <span class="n">p2</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">&gt;</span> <span class="n">p2</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">&lt;</span> <span class="n">p2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">&gt;=</span> <span class="n">p2</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p1</span> <span class="o">&lt;=</span> <span class="n">p2</span>
<span class="go">False</span>
</code></pre></div>

<h2 id="final-words">Final words<a class="headerlink" href="#final-words" title="Permanent link">&para;</a></h2>
<p>Decorators are a very powerful tool, and they are worth learning. This may be for you just the first step into the amazing world of metaprogramming or just an advanced technique you may use to simplify your code. Whatever you do with them be sure to understand the difference between the two cases (with and without arguments) and don't avoid function-based decorators just because their syntax is a bit complex.</p>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Permanent link">&para;</a></h2>
<p>Many thanks to Bruce Eckel for <a href="http://www.artima.com/weblogs/viewpost.jsp?thread=240808">his three posts</a> which have been (I think) the source for the page on <a href="http://python-3-patterns-idioms-test.readthedocs.org/en/latest/PythonDecorators.html">Python 3 Patterns, Recipes and Idioms</a> (the latter is still work in progress). Update: as Bruce stated "the Python3 Patterns book is kind of a failed project". So beware that information contained there is not going to be updated. It is however still a good starting point for Python studies and investigations.</p>
<p>A good source of advanced decorators can be found at the <a href="https://wiki.python.org/moin/PythonDecoratorLibrary">Python Decorator Library</a>, and a lot of stuff may be found on Stackoverflow under the <a href="https://stackoverflow.com/questions/tagged/python-decorators">python-decorators tag</a>.</p>
<p><a href="https://github.com/GrahamDumpleton">Graham Dumpleton</a> wrote a very interesting a in-depth analysis of Python decorators <a href="https://github.com/GrahamDumpleton/wrapt/tree/develop/blog">here</a>.</p>
<h2 id="feedback">Feedback<a class="headerlink" href="#feedback" title="Permanent link">&para;</a></h2>
<p>The <a href="https://github.com/TheDigitalCatOnline/thedigitalcatonline.github.com/issues">GitHub issues</a> page is the best place to submit corrections.</p>
  </div>


  <section>
    <header>
      <h2>Related Posts</h2>
    </header>
    <div class="paginated-posts">
      <div class="posts">
	<article class="card">
          <a href="/blog/2021/03/09/first-class-objects-in-python-generic-code-wrappers-and-factories/">
            <img src="/images/first-class-objects-in-python-generic-code-wrappers-and-factories.jpg" alt="first-class-objects-in-python-generic-code-wrappers-and-factories" />
          </a>
          <div class="body">
            <a href="/blog/2021/03/09/first-class-objects-in-python-generic-code-wrappers-and-factories/"><h2>First-class objects in Python: generic code, wrappers, and factories</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/functional-programming/" class="tag">functional programming</a>
		<a href="/categories/decorators/" class="tag">decorators</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2021-03-09T16:00:00+00:00">Mar 9, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2016/04/03/abstract-base-classes-in-python/">
            <img src="/images/abstract-base-classes.jpg" alt="abstract-base-classes" />
          </a>
          <div class="body">
            <a href="/blog/2016/04/03/abstract-base-classes-in-python/"><h2>Abstract Base Classes in Python</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/decorators/" class="tag">decorators</a>
		<a href="/categories/metaclasses/" class="tag">metaclasses</a>
		<a href="/categories/metaprogramming/" class="tag">metaprogramming</a>
		<a href="/categories/notebook/" class="tag">Notebook</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2016-04-03T11:00:00+01:00">Apr 3, 2016</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2014/10/14/decorators-and-metaclasses/">
            <img src="/images/decorators-and-metaclasses.jpg" alt="decorators-and-metaclasses" />
          </a>
          <div class="body">
            <a href="/blog/2014/10/14/decorators-and-metaclasses/"><h2>Advanced use of Python decorators and metaclasses</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/decorators/" class="tag">decorators</a>
		<a href="/categories/metaclasses/" class="tag">metaclasses</a>
		<a href="/categories/metaprogramming/" class="tag">metaprogramming</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2014-10-14T09:43:08+02:00">Oct 14, 2014</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2016/03/06/python-mocks-a-gentle-introduction-part-1/">
            <img src="/images/python-mocks.jpg" alt="python-mocks" />
          </a>
          <div class="body">
            <a href="/blog/2016/03/06/python-mocks-a-gentle-introduction-part-1/"><h2>Python Mocks: a gentle introduction - Part 1</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/decorators/" class="tag">decorators</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/pytest/" class="tag">pytest</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/testing/" class="tag">testing</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2016-03-06T18:00:00+01:00">Mar 6, 2016</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2019-02-27T23:30:00+00:00">Feb 27, 2019</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2016/09/27/python-mocks-a-gentle-introduction-part-2/">
            <img src="/images/python-mocks.jpg" alt="python-mocks" />
          </a>
          <div class="body">
            <a href="/blog/2016/09/27/python-mocks-a-gentle-introduction-part-2/"><h2>Python Mocks: a gentle introduction - Part 2</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/decorators/" class="tag">decorators</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/pytest/" class="tag">pytest</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/testing/" class="tag">testing</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2016-09-27T09:00:00+00:00">Sep 27, 2016</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2020/04/26/object-oriented-programming-concepts-in-python/">
            <img src="/images/object-oriented-programming-concepts-in-python.jpg" alt="object-oriented-programming-concepts-in-python" />
          </a>
          <div class="body">
            <a href="/blog/2020/04/26/object-oriented-programming-concepts-in-python/"><h2>Object-Oriented Programming (OOP) concepts in Python</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/metaclasses/" class="tag">metaclasses</a>
		<a href="/categories/metaprogramming/" class="tag">metaprogramming</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python3/" class="tag">Python3</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2020-04-26T00:00:00+01:00">Apr 26, 2020</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2014/09/01/python-3-oop-part-5-metaclasses/">
            <img src="/images/python-3-oop.jpg" alt="python-3-oop" />
          </a>
          <div class="body">
            <a href="/blog/2014/09/01/python-3-oop-part-5-metaclasses/"><h2>Object-Oriented Programming in Python 3 - Metaclasses</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/metaprogramming/" class="tag">metaprogramming</a>
		<a href="/categories/metaclasses/" class="tag">metaclasses</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2014-09-01T15:00:00+02:00">Sep 1, 2014</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2019-05-22T23:30:00+00:00">May 22, 2019</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2014/09/04/python-3-oop-part-6-abstract-base-classes/">
            <img src="/images/python-3-oop.jpg" alt="python-3-oop" />
          </a>
          <div class="body">
            <a href="/blog/2014/09/04/python-3-oop-part-6-abstract-base-classes/"><h2>Object-Oriented Programming in Python 3 - Abstract Base Classes</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/metaprogramming/" class="tag">metaprogramming</a>
		<a href="/categories/metaclasses/" class="tag">metaclasses</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2014-09-04T10:00:00+02:00">Sep 4, 2014</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2019-05-22T23:30:00+00:00">May 22, 2019</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2015/09/22/clojure-sequential-data-types-for-python-programmers/">
            <img src="/images/sequential-data-types.jpg" alt="sequential-data-types" />
          </a>
          <div class="body">
            <a href="/blog/2015/09/22/clojure-sequential-data-types-for-python-programmers/"><h2>Clojure sequential data types for Python programmers</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/functional-programming/" class="tag">functional programming</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/clojure/" class="tag">Clojure</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2015-09-22T19:00:00+01:00">Sep 22, 2015</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/">
            <img src="/images/clean-architectures.jpg" alt="clean-architectures" />
          </a>
          <div class="body">
            <a href="/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/"><h2>Clean architectures in Python: a step-by-step example</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/pytest/" class="tag">pytest</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/architectures/" class="tag">architectures</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2016-11-14T19:00:00+00:00">Nov 14, 2016</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2021-09-24T12:00:00+00:00">Sep 24, 2021</time></p>
	    </div>
          </div>
	</article>
      </div>
    </div>
  </section>
  
</div>

      </div>
    </div>
    <script src="/theme/js/packed.js?46a8f903"></script>

  </body>
</html>