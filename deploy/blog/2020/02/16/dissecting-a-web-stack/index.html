<!DOCTYPE HTML>
<html lang="en">
  <head>
    <title>The Digital Cat - Dissecting a Web stack</title>
    <meta charset="utf-8" />
    <meta http-equiv='content-language' content='en-gb'>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <meta name="description" content="A blog featuring in-depth posts about Python, Scala, TDD, devops, security and all things development">
<meta name="description" content="A layer-by-layer review of the components of a web stack and the reasons behind them">
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@thedigicat" />
<meta name="twitter:title" content="Dissecting a Web stack" />
<meta name="twitter:description" content="A layer-by-layer review of the components of a web stack and the reasons behind them" />
<meta name="twitter:image" content="https://www.thedigitalcatonline.com/images/dissecting-a-web-stack.jpg" />
    <script src="https://kit.fontawesome.com/15214b60ba.js" crossorigin="anonymous"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,400;0,600;1,400;1,600&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="/theme/css/main.min.css?63e1c1d2">
    <link href="/images/global/favicon.jpg" rel="icon">
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-74364524-1"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     
     gtag('config', 'UA-74364524-1');
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZ55XG1KGG"></script>
    <script>
     window.dataLayer = window.dataLayer || [];
     function gtag(){dataLayer.push(arguments);}
     gtag('js', new Date());
     
     gtag('config', 'G-FZ55XG1KGG');
    </script>
  </head>

  <body class="preload">
    <div class="container">
      <div class="sidebar navigation">
<nav>
<div class="links">
  <ul>
    <li class="link"><a href="/index.html">Homepage</a></li>
    <li class="link"><a href="/pages/about.html">About</a></li>
    <li class="link"><a href="/archives/index.html">Archives</a></li>
  </ul>
</div></nav>
<section>
  <header>
    <h2>Categories</h2>
  </header>
<ul>
  <li><a href="/category/programming/">Programming</a></li>
  <li><a href="/category/projects/">Projects</a></li>
  <li><a href="/category/retro/">Retro</a></li>
</ul></section>
<section>
  <header>
    <h2>Feeds</h2>
  </header>
<ul>
  <li><i class="fas fa-rss" aria-hidden="true"></i> <a href="/atom.xml">All posts</a></li>


  <li><i class="fas fa-rss" aria-hidden="true"></i> <a href="/category/programming/atom.xml">All posts in category: Programming</a></li>
</ul></section>
<section>
  <header>
    <h2>Tags</h2>
  </header>
<ul class="tags">
    <li class="tag tag-size-3">
      <a title="Posts about algorithms" href="/categories/algorithms/">algorithms</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about amiga" href="/categories/amiga/">amiga</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about AMQP" href="/categories/amqp/">AMQP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about architectures" href="/categories/architectures/">architectures</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about assembly" href="/categories/assembly/">assembly</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about AWS" href="/categories/aws/">AWS</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about blogging" href="/categories/blogging/">blogging</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about C" href="/categories/c/">C</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Clojure" href="/categories/clojure/">Clojure</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about compilers" href="/categories/compilers/">compilers</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about concurrent programming" href="/categories/concurrent-programming/">concurrent programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about cryptography" href="/categories/cryptography/">cryptography</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about decorators" href="/categories/decorators/">decorators</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about design" href="/categories/design/">design</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about devops" href="/categories/devops/">devops</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Django" href="/categories/django/">Django</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Docker" href="/categories/docker/">Docker</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about ed25519" href="/categories/ed25519/">ed25519</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about editor" href="/categories/editor/">editor</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Emacs" href="/categories/emacs/">Emacs</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Erlang" href="/categories/erlang/">Erlang</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Flask" href="/categories/flask/">Flask</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about functional programming" href="/categories/functional-programming/">functional programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about generators" href="/categories/generators/">generators</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Git" href="/categories/git/">Git</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about HTML" href="/categories/html/">HTML</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about HTTP" href="/categories/http/">HTTP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about infrastructure" href="/categories/infrastructure/">infrastructure</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about JavaScript" href="/categories/javascript/">JavaScript</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Lambda" href="/categories/lambda/">Lambda</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about M68000" href="/categories/m68000/">M68000</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Markdown" href="/categories/markdown/">Markdown</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Mau" href="/categories/mau/">Mau</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaclasses" href="/categories/metaclasses/">metaclasses</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaprogramming" href="/categories/metaprogramming/">metaprogramming</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Notebook" href="/categories/notebook/">Notebook</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about OOP" href="/categories/oop/">OOP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about operating systems" href="/categories/operating-systems/">operating systems</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about pelican" href="/categories/pelican/">pelican</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Pika" href="/categories/pika/">Pika</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Postage" href="/categories/postage/">Postage</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Postgres" href="/categories/postgres/">Postgres</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about pytest" href="/categories/pytest/">pytest</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python" href="/categories/python/">Python</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Python2" href="/categories/python2/">Python2</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python3" href="/categories/python3/">Python3</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about RabbitMQ" href="/categories/rabbitmq/">RabbitMQ</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about refactoring" href="/categories/refactoring/">refactoring</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about retroprogramming" href="/categories/retroprogramming/">retroprogramming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about RSA" href="/categories/rsa/">RSA</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Scala" href="/categories/scala/">Scala</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSH" href="/categories/ssh/">SSH</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSL" href="/categories/ssl/">SSL</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about TDD" href="/categories/tdd/">TDD</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Terraform" href="/categories/terraform/">Terraform</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about testing" href="/categories/testing/">testing</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about tools" href="/categories/tools/">tools</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about versioning" href="/categories/versioning/">versioning</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about video" href="/categories/video/">video</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about WWW" href="/categories/www/">WWW</a>
    </li>
</ul></section>
<section>
  <header>
    <h2>Get in touch</h2>
  </header>
  <ul class="contact">
    <li><i class="fab fa-twitter" aria-hidden="true"></i> <a href="https://twitter.com/thedigicat">Twitter</a></li>
    <li><i class="fab fa-github" aria-hidden="true"></i> <a href="https://github.com/TheDigitalCatOnline">GitHub</a></li>
  </ul>
</section>      </div>
      <div class="page">
	<header class="primary" >
	  <button type="button">
	    <i class="fas fa-bars"></i>
	  </button>
	  <p>The Digital Cat</p>
	</header>
	<div class="mobile-menu navigation">
<nav>
<div class="links">
  <ul>
    <li class="link"><a href="/index.html">Homepage</a></li>
    <li class="link"><a href="/pages/about.html">About</a></li>
    <li class="link"><a href="/archives/index.html">Archives</a></li>
  </ul>
</div></nav>
<section>
  <header>
    <h2>Categories</h2>
  </header>
<ul>
  <li><a href="/category/programming/">Programming</a></li>
  <li><a href="/category/projects/">Projects</a></li>
  <li><a href="/category/retro/">Retro</a></li>
</ul></section>
<section>
  <header>
    <h2>Tags</h2>
  </header>
<ul class="tags">
    <li class="tag tag-size-3">
      <a title="Posts about algorithms" href="/categories/algorithms/">algorithms</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about amiga" href="/categories/amiga/">amiga</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about AMQP" href="/categories/amqp/">AMQP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about architectures" href="/categories/architectures/">architectures</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about assembly" href="/categories/assembly/">assembly</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about AWS" href="/categories/aws/">AWS</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about blogging" href="/categories/blogging/">blogging</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about C" href="/categories/c/">C</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Clojure" href="/categories/clojure/">Clojure</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about compilers" href="/categories/compilers/">compilers</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about concurrent programming" href="/categories/concurrent-programming/">concurrent programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about cryptography" href="/categories/cryptography/">cryptography</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about decorators" href="/categories/decorators/">decorators</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about design" href="/categories/design/">design</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about devops" href="/categories/devops/">devops</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Django" href="/categories/django/">Django</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Docker" href="/categories/docker/">Docker</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about ed25519" href="/categories/ed25519/">ed25519</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about editor" href="/categories/editor/">editor</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Emacs" href="/categories/emacs/">Emacs</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Erlang" href="/categories/erlang/">Erlang</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Flask" href="/categories/flask/">Flask</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about functional programming" href="/categories/functional-programming/">functional programming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about generators" href="/categories/generators/">generators</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Git" href="/categories/git/">Git</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about HTML" href="/categories/html/">HTML</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about HTTP" href="/categories/http/">HTTP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about infrastructure" href="/categories/infrastructure/">infrastructure</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about JavaScript" href="/categories/javascript/">JavaScript</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Lambda" href="/categories/lambda/">Lambda</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about M68000" href="/categories/m68000/">M68000</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Markdown" href="/categories/markdown/">Markdown</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Mau" href="/categories/mau/">Mau</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaclasses" href="/categories/metaclasses/">metaclasses</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about metaprogramming" href="/categories/metaprogramming/">metaprogramming</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Notebook" href="/categories/notebook/">Notebook</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about OOP" href="/categories/oop/">OOP</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about operating systems" href="/categories/operating-systems/">operating systems</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about pelican" href="/categories/pelican/">pelican</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Pika" href="/categories/pika/">Pika</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Postage" href="/categories/postage/">Postage</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about Postgres" href="/categories/postgres/">Postgres</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about pytest" href="/categories/pytest/">pytest</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python" href="/categories/python/">Python</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Python2" href="/categories/python2/">Python2</a>
    </li>
    <li class="tag tag-size-1">
      <a title="Posts about Python3" href="/categories/python3/">Python3</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about RabbitMQ" href="/categories/rabbitmq/">RabbitMQ</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about refactoring" href="/categories/refactoring/">refactoring</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about retroprogramming" href="/categories/retroprogramming/">retroprogramming</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about RSA" href="/categories/rsa/">RSA</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about Scala" href="/categories/scala/">Scala</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSH" href="/categories/ssh/">SSH</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about SSL" href="/categories/ssl/">SSL</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about TDD" href="/categories/tdd/">TDD</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about Terraform" href="/categories/terraform/">Terraform</a>
    </li>
    <li class="tag tag-size-2">
      <a title="Posts about testing" href="/categories/testing/">testing</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about tools" href="/categories/tools/">tools</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about versioning" href="/categories/versioning/">versioning</a>
    </li>
    <li class="tag tag-size-4">
      <a title="Posts about video" href="/categories/video/">video</a>
    </li>
    <li class="tag tag-size-3">
      <a title="Posts about WWW" href="/categories/www/">WWW</a>
    </li>
</ul></section>	</div>
	
<div class="page-content">
  <header>
    <h1>Dissecting a Web stack</h1>
    <div class="post-info">
      <p>By Leonardo Giordani - <i class="fas fa-calendar-alt"></i> <time datetime="2020-02-16T15:00:00+00:00"> 16/02/2020</time> <i class="fas fa-edit"></i> Updated on <time datetime="2020-10-27T08:30:00+00:00">Oct 27, 2020</time></p>
      <p class="tags">
	<a class="tag category" href="/category/programming/" title="All posts in category Programming">Programming</a>
	<a class="tag" href="/categories/architectures/">architectures</a>
	<a class="tag" href="/categories/concurrent-programming/">concurrent programming</a>
	<a class="tag" href="/categories/cryptography/">cryptography</a>
	<a class="tag" href="/categories/devops/">devops</a>
	<a class="tag" href="/categories/infrastructure/">infrastructure</a>
	<a class="tag" href="/categories/flask/">Flask</a>
	<a class="tag" href="/categories/django/">Django</a>
	<a class="tag" href="/categories/python/">Python</a>
	<a class="tag" href="/categories/ssl/">SSL</a>
	<a class="tag" href="/categories/http/">HTTP</a>
	<a class="tag" href="/categories/www/">WWW</a>
	<a class="tag" href="/categories/aws/">AWS</a>
      </p>
      <p class="share">Share on: <span><a class="" href="https://twitter.com/intent/tweet?text=Dissecting%20a%20Web%20stack&url=https%3A//www.thedigitalcatonline.com/blog/2020/02/16/dissecting-a-web-stack/&via=thedigicat&hashtags=architectures,concurrent-programming,cryptography,devops,infrastructure,flask,django,python,ssl,http,www,aws" target="_blank" title="Share on Twitter"><i class="fab fa-twitter"></i> Twitter</a></span>
<span><a class="" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A//www.thedigitalcatonline.com/blog/2020/02/16/dissecting-a-web-stack/&title=Dissecting%20a%20Web%20stack&summary=A%20layer-by-layer%20review%20of%20the%20components%20of%20a%20web%20stack%20and%20the%20reasons%20behind%20them&source=https%3A//www.thedigitalcatonline.com/blog/2020/02/16/dissecting-a-web-stack/" target="_blank" title="Share on LinkedIn"><i class="fab fa-linkedin"></i> LinkedIn</a></span>
<span><a class="" href="https://news.ycombinator.com/submitlink?t=Dissecting%20a%20Web%20stack&u=https%3A//www.thedigitalcatonline.com/blog/2020/02/16/dissecting-a-web-stack/" target="_blank" title="Share on HackerNews"><i class="fab fa-hacker-news"></i> HackerNews</a></span>
<span><a class="" href="mailto:?subject=Dissecting%20a%20Web%20stack&amp;body=https%3A//www.thedigitalcatonline.com/blog/2020/02/16/dissecting-a-web-stack/" target="_blank" title="Share via Email"><i class="fas fa-envelope"></i> Email</a></span>
<span><a class="" href="https://www.reddit.com/submit?url=https%3A//www.thedigitalcatonline.com/blog/2020/02/16/dissecting-a-web-stack/&title=Dissecting%20a%20Web%20stack" target="_blank" title="Share via Reddit"><i class="fab fa-reddit"></i> Reddit</a></span></p>    
    </div>
  </header>
  
  <div class="post-content">
    <blockquote>
<p>It was gross. They wanted me to dissect a frog.</p>
<p>(Beetlejuice, 1988)</p>
</blockquote>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p>Having recently worked with young web developers who were exposed for the first time to proper production infrastructure, I received many questions about the various components that one can find in the architecture of a "Web service". These questions clearly expressed the confusion (and sometimes the frustration) of developers who understand how to create endpoints in a high-level language such as Node.js or Python, but were never introduced to the complexity of what happens between the user's browser and their framework of choice. Most of the times they don't know why the framework itself is there in the first place.</p>
<p>The challenge is clear if we just list (in random order), some of the words we use when we discuss (Python) Web development: HTTP, cookies, web server, Websockets, FTP, multi-threaded, reverse proxy, Django, nginx, static files, POST, certificates, framework, Flask, SSL, GET, WSGI, session management, TLS, load balancing, Apache.</p>
<p>In this post, I want to review all the words mentioned above (and a couple more) trying to build a production-ready web service from the ground up. I hope this might help young developers to get the whole picture and to make sense of these "obscure" names that senior developers like me tend to drop in everyday conversations (sometimes arguably out of turn).</p>
<p>As the focus of the post is the global architecture and the reasons behind the presence of specific components, the example service I will use will be a basic HTML web page. The reference language will be Python but the overall discussion applies to any language or framework.</p>
<p>My approach will be that of first stating the rationale and then implementing a possible solution. After this, I will point out missing pieces or unresolved issues and move on with the next layer. At the end of the process, the reader should have a clear picture of why each component has been added to the system.</p>
<h2 id="the-perfect-architecture">The perfect architecture<a class="headerlink" href="#the-perfect-architecture" title="Permanent link">&para;</a></h2>
<p>A very important underlying concept of system architectures is that there is no <em>perfect solution</em> devised by some wiser genius, that we just need to apply. Unfortunately, often people mistake design patterns for such a "magic solution". The "Design Patterns" original book, however, states that</p>
<blockquote>
<p>Your design should be specific to the problem at hand but also general enough to address future problems and requirements. You also want to avoid redesign, or at least minimize it.</p>
</blockquote>
<p>And later</p>
<blockquote>
<p>Design patterns make it easier to reuse successful designs and architectures. [...] Design patterns help you choose design alternatives that make a system reusable and avoid alternatives that compromise reusability.</p>
</blockquote>
<p>The authors of the book are discussing Object-oriented Programming, but these sentences can be applied to any architecture. As you can see, we have a "problem at hand" and "design alternatives", which means that the most important thing to understand is the requirements, both the present and future ones. Only with clear requirements in mind, one can effectively design a solution, possibly tapping into the great number of patterns that other designers already devised.</p>
<p>A very last remark. A web stack is a complex beast, made of several components and software packages developed by different programmers with different goals in mind. It is perfectly understandable, then, that such components have some degree of superposition. While the division line between theoretical layers is usually very clear, in practice the separation is often blurry. Expect this a lot, and you will never be lost in a web stack anymore.</p>
<h2 id="some-definitions">Some definitions<a class="headerlink" href="#some-definitions" title="Permanent link">&para;</a></h2>
<p>Let's briefly review some of the most important concepts involved in a Web stack, the protocols.</p>
<h3 id="tcpip">TCP/IP<a class="headerlink" href="#tcpip" title="Permanent link">&para;</a></h3>
<p>TCP/IP is a network protocol, that is, a <em>set of established rules</em> two computers have to follow to get connected over a physical network to exchange messages. TCP/IP is composed of two different protocols covering two different layers of the OSI stack, namely the Transport (TCP) and the Network (IP) ones. TCP/IP can be implemented on top of any physical interface (Data Link and Physical OSI layers), such as Ethernet and Wireless. Actors in a TCP/IP network are identified by a <em>socket</em>, which is a tuple made of an IP address and a port number.</p>
<p>As far as we are concerned when developing a Web service, however, we need to be aware that TCP/IP is a <em>reliable</em> protocol, which in telecommunications means that the protocol itself takes care or retransmissions when packets get lost. In other words, while the speed of the communication is not granted, we can be sure that once a message is sent it will reach its destination without errors.</p>
<h3 id="http">HTTP<a class="headerlink" href="#http" title="Permanent link">&para;</a></h3>
<p>TCP/IP can guarantee that the raw bytes one computer sends will reach their destination, but this leaves completely untouched the problem of how to send meaningful information. In particular, in 1989 the problem Tim Barners-Lee wanted to solve was how to uniquely name hypertext resources in a network and how to access them.</p>
<p>HTTP is the protocol that was devised to solve such a problem and has since greatly evolved. With the help of other protocols such as WebSocket, HTTP invaded areas of communication for which it was originally considered unsuitable such as real-time communication or gaming.</p>
<p>At its core, HTTP is a protocol that states the format of a text request and the possible text responses. The initial version 0.9 published in 1991 defined the concept of URL and allowed only the GET operation that requested a specific resource. HTTP 1.0 and 1.1 added crucial features such as headers, more methods, and important performance optimisations. At the time of writing the adoption of HTTP/2 is around 45% of the websites in the world, and HTTP/3 is still a draft.</p>
<p>The most important feature of HTTP we need to keep in mind as developers is that it is a <em>stateless</em> protocol. This means that the protocol doesn't require the server to keep track of the state of the communication between requests, basically leaving session management to the developer of the service itself.</p>
<p>Session management is crucial nowadays because you usually want to have an authentication layer in front of a service, where a user provides credentials and accesses some private data. It is, however, useful in other contexts such as visual preferences or choices made by the user and re-used in later accesses to the same website. Typical solutions to the session management problem of HTTP involve the use of cookies or session tokens.</p>
<h3 id="https">HTTPS<a class="headerlink" href="#https" title="Permanent link">&para;</a></h3>
<p>Security has become a very important word in recent years, and with a reason. The amount of sensitive data we exchange on the Internet or store on digital devices is increasing exponentially, but unfortunately so is the number of malicious attackers and the level of damage they can cause with their actions. The HTTP protocol is inherently</p>
<p>HTTP is inherently insecure, being a plain text communication between two servers that usually happens on a completely untrustable network such as the Internet. While security wasn't an issue when the protocol was initially conceived, it is nowadays a problem of paramount importance, as we exchange private information, often vital for people's security or for businesses. We need to be sure we are sending information to the correct server and that the data we send cannot be intercepted.</p>
<p>HTTPS solves both the problem of tampering and eavesdropping, encrypting HTTP with the Transport Layer Security (TLS) protocol, that also enforces the usage of digital certificates, issued by a trusted authority. At the time of writing, approximately 80% of websites loaded by Firefox use HTTPS by default. When a server receives an HTTPS connection and transforms it into an HTTP one it is usually said that it <em>terminates TLS</em> (or SSL, the old name of TLS).</p>
<h3 id="websocket">WebSocket<a class="headerlink" href="#websocket" title="Permanent link">&para;</a></h3>
<p>One great disadvantage of HTTP is that communication is always initiated by the client and that the server can send data only when this is explicitly requested. Polling can be implemented to provide an initial solution, but it cannot guarantee the performances of proper full-duplex communication, where a channel is kept open between server and client and both can send data without being requested. Such a channel is provided by the WebSocket protocol.</p>
<p>WebSocket is a killer technology for applications like online gaming, real-time feeds like financial tickers or sports news, or multimedia communication like conferencing or remote education.</p>
<p>It is important to understand that WebSocket is not HTTP, and can exist without it. It is also true that this new protocol was designed to be used on top of an existing HTTP connection, so a WebSocket communication is often found in parts of a Web page, which was originally retrieved using HTTP in the first place.</p>
<h2 id="implementing-a-service-over-http">Implementing a service over HTTP<a class="headerlink" href="#implementing-a-service-over-http" title="Permanent link">&para;</a></h2>
<p>Let's finally start discussing bits and bytes. The starting point for our journey is a service over HTTP, which means there is an HTTP request-response exchange. As an example, let us consider a GET request, the simplest of the HTTP methods.</p>
<div class="highlight"><pre><span></span><code><span class="nf">GET</span> <span class="nn">/</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">curl/7.65.3</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">*/*</span>
</code></pre></div>

<p>As you can see, the client is sending a pure text message to the server, with the format specified by the HTTP protocol. The first line contains the method name (<code>GET</code>), the URL (<code>/</code>) and the protocol we are using, including its version (<code>HTTP/1.1</code>). The remaining lines are called <em>headers</em> and contain metadata that can help the server to manage the request. The complete value of the <code>Host</code> header is in this case <code>localhost:80</code>, but as the standard port for HTTP services is 80, we don't need to specify it.</p>
<p>If the server <code>localhost</code> is <em>serving</em> HTTP (i.e. running some software that understands HTTP) on port 80 the response we might get is something similar to</p>
<div class="highlight"><pre><span></span><code>HTTP/1.0 200 OK
Date: Mon, 10 Feb 2020 08:41:33 GMT
Content-type: text/html
Content-Length: 26889
Last-Modified: Mon, 10 Feb 2020 08:41:27 GMT

<span class="cp">&lt;!DOCTYPE HTML&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
...
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>As happened for the request, the response is a text message, formatted according to the standard. The first line mentions the protocol and the status of the request (<code>200</code> in this case, that means success), while the following lines contain metadata in various headers. Finally, after an empty line, the message contains the resource the client asked for, the source code of the base URL of the website in this case. Since this HTML page probably contains references to other resources like CSS, JS, images, and so on, the browser will send several other requests to gather all the data it needs to properly show the page to the user.</p>
<p>So, the first problem we have is that of implementing a server that understands this protocol and sends a proper response when it receives an HTTP request. We should try to load the requested resource and return either a success (HTTP 200) if we can find it, or a failure (HTTP 404) if we can't.</p>
<h2 id="1-sockets-and-parsers">1 Sockets and parsers<a class="headerlink" href="#1-sockets-and-parsers" title="Permanent link">&para;</a></h2>
<h3 id="11-rationale">1.1 Rationale<a class="headerlink" href="#11-rationale" title="Permanent link">&para;</a></h3>
<p>TCP/IP is a network protocol that works with <em>sockets</em>. A socket is a tuple of an IP address (unique in the network) and a port (unique for a specific IP address) that the computer uses to communicate with others. A socket is a file-like object in an operating system, that can be thus <em>opened</em> and <em>closed</em>, and that we can <em>read</em> from or <em>write</em> to. Socket programming is a pretty low-level approach to the network, but you need to be aware that every software in your computer that provides network access has ultimately to deal with sockets (most probably through some library, though).</p>
<p>Since we are building things from the ground up, let's implement a small Python program that opens a socket connection, receives an HTTP request, and sends an HTTP response. As port 80 is a "low port" (a number smaller than 1024), we usually don't have permissions to open sockets there, so I will use port 8080. This is not a problem for now, as HTTP can be served on any port.</p>
<h3 id="12-implementation">1.2 Implementation<a class="headerlink" href="#12-implementation" title="Permanent link">&para;</a></h3>
<p>Create the file <code>server.py</code> and type this code. Yes, <strong>type it</strong>, don't just copy and paste, you will not learn anything otherwise.</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>

<span class="c1">## Create a socket instance</span>
<span class="c1">## AF_INET: use IP protocol version 4</span>
<span class="c1">## SOCK_STREAM: full-duplex byte stream</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c1">## Allow reuse of addresses</span>
<span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## Bind the socket to any address, port 8080, and listen</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>

<span class="c1">## Serve forever</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Accept the connection</span>
    <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="c1"># Receive data from this socket using a buffer of 1024 bytes</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

    <span class="c1"># Print out the data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c1"># Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>This little program accepts a connection on port 8080 and prints the received data on the terminal. You can test it executing it and then running <code>curl localhost:8080</code> in another terminal. You should see something like</p>
<div class="highlight"><pre><span></span><code>$ python3 server.py 
GET / HTTP/1.1
Host: localhost:8080
User-Agent: curl/7.65.3
Accept: */*
</code></pre></div>

<p>The server keeps running the code in the <code>while</code> loop, so if you want to terminate it you have to do it with Ctrl+C. So far so good, but this is not an HTTP server yet, as it sends no response; you should actually receive an error message from curl that says <code>curl: (52) Empty reply from server</code>.</p>
<p>Sending back a standard response is very simple, we just need to call <code>conn.sendall</code> passing the raw bytes. A minimal HTTP response contains the protocol and the status, an empty line, and the actual content, for example</p>
<div class="highlight"><pre><span></span><code>HTTP/1.1 200 OK

Hi there!
</code></pre></div>

<p>Our server becomes then</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>

<span class="c1">## Create a socket instance</span>
<span class="c1">## AF_INET: use IP protocol version 4</span>
<span class="c1">## SOCK_STREAM: full-duplex byte stream</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c1">## Allow reuse of addresses</span>
<span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## Bind the socket to any address, port 8080, and listen</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>

<span class="c1">## Serve forever</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Accept the connection</span>
    <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="c1"># Receive data from this socket using a buffer of 1024 bytes</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

    <span class="c1"># Print out the data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="s2">&quot;HTTP/1.1 200 OK</span><span class="se">\n\n</span><span class="s2">Hi there!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c1"># Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>At this point, we are not really responding to the user's request, however. Try different curl command lines like <code>curl localhost:8080/index.html</code> or <code>curl localhost:8080/main.css</code> and you will always receive the same response. We should try to find the resource the user is asking for and send that back in the response content.</p>
<p>This version of the HTTP server properly extracts the resource and tries to load it from the current directory, returning either a success of a failure</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="c1">## Create a socket instance</span>
<span class="c1">## AF_INET: use IP protocol version 4</span>
<span class="c1">## SOCK_STREAM: full-duplex byte stream</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="c1">## Allow reuse of addresses</span>
<span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">## Bind the socket to any address, port 8080, and listen</span>
<span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="mi">8080</span><span class="p">))</span>
<span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">()</span>

<span class="n">HEAD_200</span> <span class="o">=</span> <span class="s2">&quot;HTTP/1.1 200 OK</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="n">HEAD_404</span> <span class="o">=</span> <span class="s2">&quot;HTTP/1.1 404 Not Found</span><span class="se">\n\n</span><span class="s2">&quot;</span>

<span class="c1">## Serve forever</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="c1"># Accept the connection</span>
    <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

    <span class="c1"># Receive data from this socket using a buffer of 1024 bytes</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

    <span class="n">request</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="c1"># Print out the data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

    <span class="n">resource</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;GET /(.*) HTTP&#39;</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">HEAD_200</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resource </span><span class="si">{}</span><span class="s1"> correctly served&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">HEAD_404</span> <span class="o">+</span> <span class="s2">&quot;Resource /</span><span class="si">{}</span><span class="s2"> cannot be found</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Resource </span><span class="si">{}</span><span class="s1"> cannot be loaded&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">resource</span><span class="p">))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------------------&#39;</span><span class="p">)</span>

    <span class="n">conn</span><span class="o">.</span><span class="n">sendall</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>

    <span class="c1"># Close the connection</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>

<p>As you can see this implementation is extremely simple. If you create a simple local file named <code>index.html</code> with this content</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>This is my page<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;main.css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Some random content<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>

<p>and run <code>curl localhost:8080/index.html</code> you will see the content of the file. At this point, you can even use your browser to open <code>http://localhost:8080/index.html</code> and you will see the title of the page and the content. A Web browser is a software capable of sending HTTP requests and of interpreting the content of the responses if this is HTML (and many other file types like images or videos), so it can <em>render</em> the content of the message. The browser is also responsible of retrieving the missing resources needed for the rendering, so when you provide links to style sheets or JS scripts with the <code>&lt;link&gt;</code> or the <code>&lt;script&gt;</code> tags in the HTML code of a page, you are instructing the browser to send an HTTP GET request for those files as well.</p>
<p>The output of <code>server.py</code> when I access <code>http://localhost:8080/index.html</code> is</p>
<div class="highlight"><pre><span></span><code><span class="nf">GET</span> <span class="nn">/index.html</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">localhost:8080</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:72.0) Gecko/20100101 Firefox/72.0</span>
<span class="na">Accept</span><span class="o">:</span> <span class="l">text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span>
<span class="na">Accept-Language</span><span class="o">:</span> <span class="l">en-GB,en;q=0.5</span>
<span class="na">Accept-Encoding</span><span class="o">:</span> <span class="l">gzip, deflate</span>
<span class="na">Connection</span><span class="o">:</span> <span class="l">keep-alive</span>
<span class="na">Upgrade-Insecure-Requests</span><span class="o">:</span> <span class="l">1</span>
<span class="na">Pragma</span><span class="o">:</span> <span class="l">no-cache</span>
<span class="na">Cache-Control</span><span class="o">:</span> <span class="l">no-cache</span>


Resource index.html correctly served
--------------------
GET /main.css HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: text/css,*/*;q=0.1
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Referer: http://localhost:8080/index.html
Pragma: no-cache
Cache-Control: no-cache


Resource main.css cannot be loaded
--------------------
GET /favicon.ico HTTP/1.1
Host: localhost:8080
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:72.0) Gecko/20100101 Firefox/72.0
Accept: image/webp,*/*
Accept-Language: en-GB,en;q=0.5
Accept-Encoding: gzip, deflate
Connection: keep-alive
Pragma: no-cache
Cache-Control: no-cache


Resource favicon.ico cannot be loaded
--------------------
</code></pre></div>

<p>As you can see the browser sends rich HTTP requests, with a lot of headers, automatically requesting the CSS file mentioned in the HTML code and automatically trying to retrieve a favicon image.</p>
<h3 id="13-resources">1.3 Resources<a class="headerlink" href="#13-resources" title="Permanent link">&para;</a></h3>
<p>These resources provide more detailed information on the topics discussed in this section</p>
<ul>
<li><a href="https://docs.python.org/3/howto/sockets.html">Python 3 Socket Programming HOWTO</a></li>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec5.html#sec5">HTTP/1.1 Request format</a></li>
<li><a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec6.html#sec6">HTTP/1.1 Response format</a></li>
<li>The source code of this example is available <a href="https://github.com/lgiordani/dissecting-a-web-stack-code/tree/master/1_sockets_and_parsers">here</a></li>
</ul>
<h3 id="14-issues">1.4 Issues<a class="headerlink" href="#14-issues" title="Permanent link">&para;</a></h3>
<p>It gives a certain dose of satisfaction to build something from scratch and discover that it works smoothly with full-fledged software like the browser you use every day. I also think it is very interesting to discover that technologies like HTTP, that basically run the world nowadays, are at their core very simple.</p>
<p>That said, there are many features of HTTP that we didn't cover with our simple socket programming. For starters, HTTP/1.0 introduced other methods after GET, such as POST that is of paramount importance for today's websites, where users keep sending information to servers through forms. To implement all 9 HTTP methods we need to properly parse the incoming request and add relevant functions to our code.</p>
<p>At this point, however, you might notice that we are dealing a lot with low-level details of the protocol, which is usually not the core of our business. When we build a service over HTTP we believe that we have the knowledge to properly implement some code that can simplify a certain process, be it searching for other websites, shopping for books or sharing pictures with friends. We don't want to spend our time understanding the subtleties of the TCP/IP sockets and writing parsers for request-response protocols. It is nice to see how these technologies work, but on a daily basis, we need to focus on something at a higher level.</p>
<p>The situation of our small HTTP server is possibly worsened by the fact that HTTP is a stateless protocol. The protocol doesn't provide any way to connect two successive requests, thus keeping track of the <em>state</em> of the communication, which is the cornerstone of modern Internet. Every time we authenticate on a website and we want to visit other pages we need the server to remember who we are, and this implies keeping track of the state of the connection.</p>
<p>Long story short: to work as a proper HTTP server, our code should at this point implement all HTTP methods and cookies management. We also need to support other protocols like Websockets. These are all but trivial tasks, so we definitely need to add some component to the whole system that lets us focus on the business logic and not on the low-level details of application protocols.</p>
<h2 id="2-web-framework">2 Web framework<a class="headerlink" href="#2-web-framework" title="Permanent link">&para;</a></h2>
<h3 id="21-rationale">2.1 Rationale<a class="headerlink" href="#21-rationale" title="Permanent link">&para;</a></h3>
<p>Enter the Web framework!</p>
<p>As I discussed many times (see <a href="https://www.thedigitalcatonline.com/blog/2018/12/20/cabook/">the book on clean architectures</a> or <a href="https://www.thedigitalcatonline.com/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/">the relative post</a>) the role of the Web framework is that of <em>converting HTTP requests into function calls</em>, and function return values into HTTP responses. The framework's true nature is that of a layer that connects a working business logic to the Web, through HTTP and related protocols. The framework takes care of session management for us and maps URLs to functions, allowing us to focus on the application logic.</p>
<p>In the grand scheme of an HTTP service, this is what the framework is supposed to do. Everything the framework provides out of this scope, like layers to access DBs, template engines, and interfaces to other systems, is an addition that you, as a programmer, may find useful, but is not in principle part of the reason why we added the framework to the system. We add the framework because it acts as a layer between our business logic and HTTP.</p>
<h3 id="22-implementation">2.2 Implementation<a class="headerlink" href="#22-implementation" title="Permanent link">&para;</a></h3>
<p>Thanks to Miguel Gringberg and his <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">amazing Flask mega-tutorial</a> I can set up Flask in seconds. I will not run through the tutorial here, as you can follow it on Miguel's website. I will only use the content of the first article (out of 23!) to create an extremely simple "Hello, world" application.</p>
<p>To run the following example you will need a virtual environment and you will have to <code>pip install flask</code>. Follow Miguel's tutorial if you need more details on this.</p>
<p>The <code>app/__init__.py</code> file is</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="n">application</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">routes</span>
</code></pre></div>

<p>and the <code>app/routes.py</code> file is</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">application</span>


<span class="nd">@application</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="nd">@application</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/index&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;Hello, world!&quot;</span>
</code></pre></div>

<p>You can already see here the power of a framework in action. We defined an <code>index</code> function and connected it with two different URLs (<code>/</code> and <code>/index</code>) in 3 lines of Python. This leaves us time and energy to properly work on the business logic, that in this case is a revolutionary "Hello, world!". Nobody ever did this before.</p>
<p>Finally, the <code>service.py</code> file is</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">application</span>
</code></pre></div>

<p>Flask comes with a so-called development web server (do these words ring any bell now?) that we can run on a terminal</p>
<div class="highlight"><pre><span></span><code>$ <span class="nv">FLASK_APP</span><span class="o">=</span>service.py flask run
 * Serving Flask app <span class="s2">&quot;service.py&quot;</span>
 * Environment: production
   WARNING: This is a development server. Do not use it <span class="k">in</span> a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://127.0.0.1:5000/ <span class="o">(</span>Press CTRL+C to quit<span class="o">)</span>
</code></pre></div>

<p>You can now visit the given URL with your browser and see that everything works properly. Remember that 127.0.0.1 is the special IP address that refers to "this computer"; the name <code>localhost</code> is usually created by the operating system as an alias for that, so the two are interchangeable. As you can see the standard port for Flask's development server is 5000, so you have to mention it explicitly, otherwise your browser would try to access port 80 (the default HTTP one). When you connect with the browser you will see some log messages about the HTTP requests</p>
<div class="highlight"><pre><span></span><code><span class="m">127</span>.0.0.1 - - <span class="o">[</span><span class="m">14</span>/Feb/2020 <span class="m">14</span>:54:27<span class="o">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="m">200</span> -
<span class="m">127</span>.0.0.1 - - <span class="o">[</span><span class="m">14</span>/Feb/2020 <span class="m">14</span>:54:28<span class="o">]</span> <span class="s2">&quot;GET /favicon.ico HTTP/1.1&quot;</span> <span class="m">404</span> -
</code></pre></div>

<p>You can recognise both now, as those are the same request we got with our little server in the previous part of the article.</p>
<h3 id="23-resources">2.3 Resources<a class="headerlink" href="#23-resources" title="Permanent link">&para;</a></h3>
<p>These resources provide more detailed information on the topics discussed in this section</p>
<ul>
<li><a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world">Miguel Gringberg's amazing Flask mega-tutorial</a></li>
<li><a href="https://en.wikipedia.org/wiki/Localhost">What is localhost</a></li>
<li>The source code of this example is available <a href="https://github.com/lgiordani/dissecting-a-web-stack-code/tree/master/2_web_framework">here</a></li>
</ul>
<h3 id="24-issues">2.4 Issues<a class="headerlink" href="#24-issues" title="Permanent link">&para;</a></h3>
<p>Apparently, we solved all our problems, and many programmers just stop here. They learn how to use the framework (which is a big achievement!), but as we will shortly discover, this is not enough for a production system. Let's have a closer look at the output of the Flask server. It clearly says, among other things</p>
<div class="highlight"><pre><span></span><code>   WARNING: This is a development server. Do not use it <span class="k">in</span> a production deployment.
   Use a production WSGI server instead.
</code></pre></div>

<p>The main issue we have when we deal with any production system is represented by performances. Think about what we do with JavaScript when we minimise the code: we consciously obfuscate the code in order to make the file smaller, but this is done for the sole purpose of making the file faster to retrieve.</p>
<p>For HTTP servers the story is not very different. The Web framework usually provides a development Web server, as Flask does, which properly implements HTTP, but does it in a very inefficient way. For starters, this is a <em>blocking</em> framework, which means that if our request takes seconds to be served (for example because the endpoint retrieves data from a very slow database), any other request will have to wait to be served in a queue. That ultimately means that the user will see a spinner in the browser's tab and just shake their head thinking that we can't build a modern website. Other performances concerns might be connected with memory management or disk caches, but in general, we are safe to say that this web server cannot handle any production load (i.e. multiple users accessing the web site at the same time and expecting good quality of service).</p>
<p>This is hardly surprising. After all, we didn't want to deal with TCP/IP connections to focus on our business, so we delegated this to other coders who maintain the framework. The framework's authors, in turn, want to focus on things like middleware, routes, proper handling of HTTP methods, and so on. They don't want to spend time trying to optimise the performances of the "multi-user" experience. This is especially true in the Python world (and somehow less true for Node.js, for example): Python is not heavily concurrency-oriented, and both the style of programming and the performances are not favouring fast, non-blocking applications. This is changing lately, with async and improvements in the interpreter, but I leave this for another post.</p>
<p>So, now that we have a full-fledged HTTP service, we need to make it so fast that users won't even notice this is not running locally on their computer.</p>
<h2 id="3-concurrency-and-facades">3 Concurrency and faades<a class="headerlink" href="#3-concurrency-and-facades" title="Permanent link">&para;</a></h2>
<h3 id="31-rationale">3.1 Rationale<a class="headerlink" href="#31-rationale" title="Permanent link">&para;</a></h3>
<p>Well, whenever you have performance issues, just go for concurrency. Now you have many problems!
(see <a href="https://twitter.com/davidlohr/status/288786300067270656?lang=en">here</a>)</p>
<p>Yes, concurrency solves many problems and it's the source of just as much, so we need to find a way to use it in the safest and less complicated way. We basically might want to add a layer that runs the framework in some concurrent way, without requiring us to change anything in the framework itself.</p>
<p>And whenever you have to homogenise different things just create a layer of indirection. This solves any problem but one. (see <a href="https://en.wikipedia.org/wiki/Fundamental_theorem_of_software_engineering">here</a>)</p>
<p>So we need to create a layer that runs our service in a concurrent way, but we also want to keep it detached from the specific implementation of the service, that is independent of the framework or library that we are using.</p>
<h3 id="32-implementation">3.2 Implementation<a class="headerlink" href="#32-implementation" title="Permanent link">&para;</a></h3>
<p>In this case, the solution is that of giving a <em>specification</em> of the API that web frameworks have to expose, in order to be usable by independent third-party components. In the Python world, this set of rules has been named WSGI, the Web Server Gateway Interface, but such interfaces exist for other languages such as Java or Ruby. The "gateway" mentioned here is the part of the system outside the framework, which in this discussion is the part that deals with production performances. Through WSGI we are defining a way for frameworks to expose a common interface, leaving people interested in concurrency free to implement something independently.</p>
<p>If the framework is compatible with the gateway interface, we can add software that deals with concurrency and uses the framework through the compatibility layer. Such a component is a production-ready HTTP server, and two common choices in the Python world are Gunicorn and uWSGI.</p>
<p>Production-ready HTTP server means that the software understands HTTP as the development server already did, but at the same time pushes performances in order to sustain a bigger workload, and as we said before this is done through concurrency.</p>
<p>Flask is compatible with WSGI, so we can make it work with Gunicorn. To install it in our virtual environment run <code>pip install gunicorn</code> and set it up creating a file names <code>wsgi.py</code> with the following content</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">application</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">application</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</code></pre></div>

<p>To run Gunicorn specify the number of concurrent instances and the external port</p>
<div class="highlight"><pre><span></span><code>$ gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 wsgi
<span class="o">[</span><span class="m">2020</span>-02-12 <span class="m">18</span>:39:07 +0000<span class="o">]</span> <span class="o">[</span><span class="m">13393</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Starting gunicorn <span class="m">20</span>.0.4
<span class="o">[</span><span class="m">2020</span>-02-12 <span class="m">18</span>:39:07 +0000<span class="o">]</span> <span class="o">[</span><span class="m">13393</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Listening at: http://0.0.0.0:8000 <span class="o">(</span><span class="m">13393</span><span class="o">)</span>
<span class="o">[</span><span class="m">2020</span>-02-12 <span class="m">18</span>:39:07 +0000<span class="o">]</span> <span class="o">[</span><span class="m">13393</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Using worker: sync
<span class="o">[</span><span class="m">2020</span>-02-12 <span class="m">18</span>:39:07 +0000<span class="o">]</span> <span class="o">[</span><span class="m">13396</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Booting worker with pid: <span class="m">13396</span>
<span class="o">[</span><span class="m">2020</span>-02-12 <span class="m">18</span>:39:07 +0000<span class="o">]</span> <span class="o">[</span><span class="m">13397</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Booting worker with pid: <span class="m">13397</span>
<span class="o">[</span><span class="m">2020</span>-02-12 <span class="m">18</span>:39:07 +0000<span class="o">]</span> <span class="o">[</span><span class="m">13398</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Booting worker with pid: <span class="m">13398</span>
</code></pre></div>

<p>As you can see, Gunicorn has the concept of <em>workers</em> which are a generic way to express concurrency. Specifically, Gunicorn implements a pre-fork worker model, which means that it (pre)creates a different Unix process for each worker. You can check this running <code>ps</code></p>
<div class="highlight"><pre><span></span><code>$ ps ax <span class="p">|</span> grep gunicorn
<span class="m">14919</span> pts/1    S+     <span class="m">0</span>:00 ~/venv3/bin/python3 ~/venv3/bin/gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 wsgi
<span class="m">14922</span> pts/1    S+     <span class="m">0</span>:00 ~/venv3/bin/python3 ~/venv3/bin/gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 wsgi
<span class="m">14923</span> pts/1    S+     <span class="m">0</span>:00 ~/venv3/bin/python3 ~/venv3/bin/gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 wsgi
<span class="m">14924</span> pts/1    S+     <span class="m">0</span>:00 ~/venv3/bin/python3 ~/venv3/bin/gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 wsgi
</code></pre></div>

<p>Using processes is just one of the two ways to implement concurrency in a Unix system, the other being using threads. The benefits and demerits of each solution are outside the scope of this post, however. For the time being just remember that you are dealing with multiple workers that process incoming requests asynchronously, thus implementing a non-blocking server, ready to accept multiple connections.</p>
<h3 id="33-resources">3.3 Resources<a class="headerlink" href="#33-resources" title="Permanent link">&para;</a></h3>
<p>These resources provide more detailed information on the topics discussed in this section</p>
<ul>
<li>The <a href="https://wsgi.readthedocs.io/en/latest/index.html">WSGI official documentation</a> and the <a href="https://en.wikipedia.org/wiki/Web_Server_Gateway_Interface">Wikipedia page
</a></li>
<li>The homepages of <a href="https://gunicorn.org/">Gunicorn</a> and <a href="https://uwsgi-docs.readthedocs.io/en/latest/">uWSGI</a></li>
<li>A good entry point for your journey into the crazy world of concurrency: <a href="https://en.wikipedia.org/wiki/Multithreading_(computer_architecture)">multithreading</a>.</li>
<li>The source code of this example is available <a href="https://github.com/lgiordani/dissecting-a-web-stack-code/tree/master/3_concurrency_and_facades">here</a></li>
</ul>
<h3 id="34-issues">3.4 Issues<a class="headerlink" href="#34-issues" title="Permanent link">&para;</a></h3>
<p>Using a Gunicorn we have now a production-ready HTTP server, and apparently implemented everything we need. There are still many considerations and missing pieces, though.</p>
<h4 id="performances-again">Performances (again)<a class="headerlink" href="#performances-again" title="Permanent link">&para;</a></h4>
<p>Are 3 workers enough to sustain the load of our new killer mobile application? We expect thousands of visitors per minute, so maybe we should add some. But while we increase the amount of workers, we have to keep in mind that the machine we are using has a finite amount of CPU power and memory. So, once again, we have to focus on performances, and in particular on scalability: how can we keep adding workers without having to stop the application, replace the machine with a more powerful one, and restart the service?</p>
<h4 id="embrace-change">Embrace change<a class="headerlink" href="#embrace-change" title="Permanent link">&para;</a></h4>
<p>This is not the only problem we have to face in production. An important aspect of technology is that it changes over time, as new and (hopefully) better solutions become widespread. We usually design systems dividing them as much as possible into communicating layers exactly because we want to be free to replace a layer with something else, be it a simpler component or a more advanced one, one with better performances or maybe just a cheaper one. So, once again, we want to be able to evolve the underlying system keeping the same interface, exactly as we did in the case of web frameworks.</p>
<h4 id="https_1">HTTPS<a class="headerlink" href="#https_1" title="Permanent link">&para;</a></h4>
<p>Another missing part of the system is HTTPS. Gunicorn and uWSGI do not understand the HTTPS protocol, so we need something in front of them that will deal with the "S" part of the protocol, leaving the "HTTP" part to the internal layers.</p>
<h4 id="load-balancers">Load balancers<a class="headerlink" href="#load-balancers" title="Permanent link">&para;</a></h4>
<p>In general, a <em>load balancer</em> is just a component in a system that distributes work among a pool of workers. Gunicorn is already distributing load among its workers, so this is not a new concept, but we generally want to do it on a bigger level, among machines or among entire systems. Load balancing can be hierarchical and be structured on many levels. We can also assign more importance to some components of the system, flagging them as ready to accept more load (for example because their hardware is better). Load balancers are extremely important in network services, and the definition of load can be extremely different from system to system: generally speaking, in a Web service the number of connections is the standard measure of the load, as we assume that on average all connections bring the same amount of work to the system.</p>
<h4 id="reverse-proxies">Reverse proxies<a class="headerlink" href="#reverse-proxies" title="Permanent link">&para;</a></h4>
<p>Load balancers are forward proxies, as they allow a client to contact any server in a pool. At the same time, a <em>reverse proxy</em> allows a client to retrieve data produced by several systems through the same entry point. Reverse proxies are a perfect way to route HTTP requests to sub-systems that can be implemented with different technologies. For example, you might want to have part of the system implemented with Python, using Django and Postgres, and another part served by an AWS Lambda function written in Go and connected with a non-relational database such as DynamoDB. Usually, in HTTP services this choice is made according to the URL (for example routing every URL that begins with <code>/api/</code>).</p>
<h4 id="logic">Logic<a class="headerlink" href="#logic" title="Permanent link">&para;</a></h4>
<p>We also want a layer that can implement a certain amount of logic, to manage simple rules that are not related to the service we implemented. A typical example is that of HTTP redirections: what happens if a user accesses the service with an <code>http://</code> prefix instead of <code>https://</code>? The correct way to deal with this is through an HTTP 301 code, but you don't want such a request to reach your framework, wasting resources for such a simple task.</p>
<h2 id="4-the-web-server">4 The Web server<a class="headerlink" href="#4-the-web-server" title="Permanent link">&para;</a></h2>
<h3 id="41-rationale">4.1 Rationale<a class="headerlink" href="#41-rationale" title="Permanent link">&para;</a></h3>
<p>The general label of <em>Web server</em> is given to software that performs the tasks we discussed. Two very common choices for this part of the system are nginx and Apache, two open source projects that are currently leading the market. With different technical approaches, they both implement all the features we discussed in the previous section (and many more).</p>
<h3 id="42-implementation">4.2 Implementation<a class="headerlink" href="#42-implementation" title="Permanent link">&para;</a></h3>
<p>To test nginx without having to fight with the OS and install too many packages we can use Docker. Docker is useful to simulate a multi-machine environment, but it might also be your technology of choice for the actual production environment (AWS ECS works with Docker containers, for example).</p>
<p>The base configuration that we will run is very simple. One container will contain the Flask code and run the framework with Gunicorn, while the other container will run nginx. Gunicorn will serve HTTP on the internal port 8000, not exposed by Docker and thus not reachable from our browser, while nignx will expose port 80, the traditional HTTP port.</p>
<p>In the same directory of the file <code>wsgi.py</code>, create a <code>Dockerfile</code></p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">python:3.6</span>

<span class="k">ADD</span><span class="w"> </span>app /app
<span class="k">ADD</span><span class="w"> </span>wsgi.py /

<span class="k">WORKDIR</span><span class="w"> </span><span class="s">.</span>
<span class="k">RUN</span><span class="w"> </span>pip install flask gunicorn
<span class="k">EXPOSE</span><span class="w"> </span><span class="s">8000</span>
</code></pre></div>

<p>This starts from a Python Docker image, adds the <code>app</code> directory and the <code>wsgi.py</code> file, and installs Gunicorn. Now create a configuration for nginx in a file called <code>nginx.conf</code> in the same directory</p>
<div class="highlight"><pre><span></span><code><span class="k">server</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">localhost</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://application:8000/</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>This defines a server that listens on port 80 and that connects all the URL starting with <code>/</code> with a server called <code>application</code> on port 8000, which is the container running Gunicorn.</p>
<p>Last, create a file <code>docker-compose.yml</code> that will describe the configuration of the containers.</p>
<div class="highlight"><pre><span></span><code><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3.7&quot;</span><span class="w"></span>
<span class="nt">services</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">application</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.</span><span class="w"></span>
<span class="w">      </span><span class="nt">dockerfile</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Dockerfile</span><span class="w"></span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gunicorn --workers 3 --bind 0.0.0.0:8000 wsgi</span><span class="w"></span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8000</span><span class="w"></span>

<span class="w">  </span><span class="nt">nginx</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"></span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w"></span>
<span class="w">     </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./nginx.conf:/etc/nginx/conf.d/default.conf</span><span class="w"></span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:80</span><span class="w"></span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">application</span><span class="w"></span>
</code></pre></div>

<p>As you can see the name <code>application</code> that we mentioned in the nginx configuration file is not a magic string, but is the name we assigned to the Gunicorn container in the Docker Compose configuration. Please note that nginx listens on port 80 inside the container, but the port is published as 8080 on the host.</p>
<p>To create this infrastructure we need to install Docker Compose in our virtual environment through <code>pip install docker-compose</code>. I also created a file named <code>.env</code> with the name of the project</p>
<div class="highlight"><pre><span></span><code><span class="nv">COMPOSE_PROJECT_NAME</span><span class="o">=</span>service
</code></pre></div>

<p>At this point you can run Docker Compose with <code>docker-compose up -d</code></p>
<div class="highlight"><pre><span></span><code>$ docker-compose up -d
Creating network <span class="s2">&quot;service_default&quot;</span> with the default driver
Creating service_application_1 ... <span class="k">done</span>
Creating service_nginx_1       ... <span class="k">done</span>
</code></pre></div>

<p>If everything is working correctly, opening the browser and visiting <code>localhost:8080</code> should show you the HTML page Flask is serving.</p>
<p>Through <code>docker-compose logs</code> we can check what services are doing. We can recognise the output of Gunicorn in the logs of the service named <code>application</code></p>
<div class="highlight"><pre><span></span><code>$ docker-compose logs application
Attaching to service_application_1
application_1  <span class="p">|</span> <span class="o">[</span><span class="m">2020</span>-02-14 <span class="m">08</span>:35:42 +0000<span class="o">]</span> <span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Starting gunicorn <span class="m">20</span>.0.4
application_1  <span class="p">|</span> <span class="o">[</span><span class="m">2020</span>-02-14 <span class="m">08</span>:35:42 +0000<span class="o">]</span> <span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Listening at: http://0.0.0.0:8000 <span class="o">(</span><span class="m">1</span><span class="o">)</span>
application_1  <span class="p">|</span> <span class="o">[</span><span class="m">2020</span>-02-14 <span class="m">08</span>:35:42 +0000<span class="o">]</span> <span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Using worker: sync
application_1  <span class="p">|</span> <span class="o">[</span><span class="m">2020</span>-02-14 <span class="m">08</span>:35:42 +0000<span class="o">]</span> <span class="o">[</span><span class="m">8</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Booting worker with pid: <span class="m">8</span>
application_1  <span class="p">|</span> <span class="o">[</span><span class="m">2020</span>-02-14 <span class="m">08</span>:35:42 +0000<span class="o">]</span> <span class="o">[</span><span class="m">9</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Booting worker with pid: <span class="m">9</span>
application_1  <span class="p">|</span> <span class="o">[</span><span class="m">2020</span>-02-14 <span class="m">08</span>:35:42 +0000<span class="o">]</span> <span class="o">[</span><span class="m">10</span><span class="o">]</span> <span class="o">[</span>INFO<span class="o">]</span> Booting worker with pid: <span class="m">10</span>
</code></pre></div>

<p>but the one we are mostly interested with now is the service named <code>nginx</code>, so let's follow the logs in real-time with <code>docker-compose logs -f nginx</code>. Refresh the <code>localhost</code> page you visited with the browser, and the container should output something like</p>
<div class="highlight"><pre><span></span><code>$ docker-compose logs -f nginx
Attaching to service_nginx_1
nginx_1        <span class="p">|</span> <span class="m">192</span>.168.192.1 - - <span class="o">[</span><span class="m">14</span>/Feb/2020:08:42:20 +0000<span class="o">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="m">200</span> <span class="m">13</span> <span class="s2">&quot;-&quot;</span> <span class="s2">&quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:72.0) Gecko/20100101 Firefox/72.0&quot;</span> <span class="s2">&quot;-&quot;</span>
</code></pre></div>

<p>which is the standard log format of nginx. It shows the IP address of the client (<code>192.168.192.1</code>), the connection timestamp, the HTTP request and the response status code (200), plus other information on the client itself.</p>
<p>Let's now increase the number of services, to see the load balancing mechanism in action. To do this, first we need to change the log format of nginx to show the IP address of the machine that served the request. Change the <code>nginx.conf</code> file adding the <code>log_format</code> and <code>access_log</code> options</p>
<div class="highlight"><pre><span></span><code><span class="k">log_format</span><span class="w"> </span><span class="s">upstreamlog</span><span class="w"> </span><span class="s">&#39;[</span><span class="nv">$time_local]</span><span class="w"> </span><span class="nv">$host</span><span class="w"> </span><span class="s">to:</span><span class="w"> </span><span class="nv">$upstream_addr:</span><span class="w"> </span><span class="nv">$request</span><span class="w"> </span><span class="nv">$status&#39;</span><span class="p">;</span><span class="w"></span>

<span class="k">server</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">localhost</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://application:8000</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/access.log</span><span class="w"> </span><span class="s">upstreamlog</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>The <code>$upstream_addr</code> variable is the one that contains the IP address of the server proxied by nginx. Now run <code>docker-compose down</code> to stop all containers and then <code>docker-compose up -d --scale application=3</code> to start them again</p>
<div class="highlight"><pre><span></span><code>$ docker-compose down
Stopping service_nginx_1       ... <span class="k">done</span>
Stopping service_application_1 ... <span class="k">done</span>
Removing service_nginx_1       ... <span class="k">done</span>
Removing service_application_1 ... <span class="k">done</span>
Removing network service_default
$ docker-compose up -d --scale <span class="nv">application</span><span class="o">=</span><span class="m">3</span>
Creating network <span class="s2">&quot;service_default&quot;</span> with the default driver
Creating service_application_1 ... <span class="k">done</span>
Creating service_application_2 ... <span class="k">done</span>
Creating service_application_3 ... <span class="k">done</span>
Creating service_nginx_1       ... <span class="k">done</span>
</code></pre></div>

<p>As you can see, Docker Compose runs now 3 containers for the <code>application</code> service. If you open the logs stream and visit the page in the browser you will now see a slightly different output</p>
<div class="highlight"><pre><span></span><code>$ docker-compose logs -f nginx
Attaching to service_nginx_1
nginx_1        <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:09:00:16 +0000<span class="o">]</span> localhost to: <span class="m">192</span>.168.240.4:8000: GET / HTTP/1.1 <span class="m">200</span>
</code></pre></div>

<p>where you can spot <code>to: 192.168.240.4:8000</code> which is the IP address of one of the application containers. Please note that the IP address you see might be different, as it depends on the Docker network settings. If you now visit the page again multiple times you should notice a change in the upstream address, something like</p>
<div class="highlight"><pre><span></span><code>$ docker-compose logs -f nginx
Attaching to service_nginx_1
nginx_1        <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:09:00:16 +0000<span class="o">]</span> localhost to: <span class="m">192</span>.168.240.4:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1        <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:09:00:17 +0000<span class="o">]</span> localhost to: <span class="m">192</span>.168.240.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1        <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:09:00:17 +0000<span class="o">]</span> localhost to: <span class="m">192</span>.168.240.3:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1        <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:09:00:17 +0000<span class="o">]</span> localhost to: <span class="m">192</span>.168.240.4:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1        <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:09:00:17 +0000<span class="o">]</span> localhost to: <span class="m">192</span>.168.240.2:8000: GET / HTTP/1.1 <span class="m">200</span>
</code></pre></div>

<p>This shows that nginx is performing load balancing, but to tell the truth this is happening through Docker's DNS, and not by an explicit action performed by the web server. We can verify this accessing the nginx container and running <code>dig application</code> (you need to run <code>apt update</code> and <code>apt install dnsutils</code> to install <code>dig</code>)</p>
<div class="highlight"><pre><span></span><code>$ docker-compose <span class="nb">exec</span> nginx /bin/bash
root@99c2f348140e:/# apt update
root@99c2f348140e:/# apt install -y dnsutils
root@99c2f348140e:/# dig application

<span class="p">;</span> &lt;&lt;&gt;&gt; DiG <span class="m">9</span>.11.5-P4-5.1-Debian &lt;&lt;&gt;&gt; application
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="s">&lt;&lt;- opco</span>de: QUERY, status: NOERROR, id: <span class="m">7221</span>
<span class="p">;;</span> flags: qr rd ra<span class="p">;</span> QUERY: <span class="m">1</span>, ANSWER: <span class="m">3</span>, AUTHORITY: <span class="m">0</span>, ADDITIONAL: <span class="m">0</span>

<span class="p">;;</span> QUESTION SECTION:
<span class="p">;</span>application.                   IN      A

<span class="p">;;</span> ANSWER SECTION:
application.            <span class="m">600</span>     IN      A       <span class="m">192</span>.168.240.2
application.            <span class="m">600</span>     IN      A       <span class="m">192</span>.168.240.4
application.            <span class="m">600</span>     IN      A       <span class="m">192</span>.168.240.3

<span class="p">;;</span> Query time: <span class="m">1</span> msec
<span class="p">;;</span> SERVER: <span class="m">127</span>.0.0.11#53<span class="o">(</span><span class="m">127</span>.0.0.11<span class="o">)</span>
<span class="p">;;</span> WHEN: Fri Feb <span class="m">14</span> <span class="m">09</span>:57:24 UTC <span class="m">2020</span>
<span class="p">;;</span> MSG SIZE  rcvd: <span class="m">110</span>
</code></pre></div>

<p>To see load balancing performed by nginx we can explicitly define two services and assign them different weights. Run <code>docker-compose down</code> and change the nginx configuration to</p>
<div class="highlight"><pre><span></span><code><span class="k">upstream</span><span class="w"> </span><span class="s">app</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="n">application1</span><span class="p">:</span><span class="mi">8000</span><span class="w"> </span><span class="s">weight=3</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kn">server</span><span class="w"> </span><span class="n">application2</span><span class="p">:</span><span class="mi">8000</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">log_format</span><span class="w"> </span><span class="s">upstreamlog</span><span class="w"> </span><span class="s">&#39;[</span><span class="nv">$time_local]</span><span class="w"> </span><span class="nv">$host</span><span class="w"> </span><span class="s">to:</span><span class="w"> </span><span class="nv">$upstream_addr:</span><span class="w"> </span><span class="nv">$request</span><span class="w"> </span><span class="nv">$status&#39;</span><span class="p">;</span><span class="w"></span>

<span class="k">server</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kn">listen</span><span class="w"> </span><span class="mi">80</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">localhost</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://app</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>

<span class="w">    </span><span class="kn">access_log</span><span class="w"> </span><span class="s">/var/log/nginx/access.log</span><span class="w"> </span><span class="s">upstreamlog</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>We defined here an <code>upstream</code> structure that lists two different services, <code>application1</code> and <code>application2</code>, giving to the first one a weight of 3. This mean that each 4 requests, 3 will be routed to the first service, and one to the second service. Now nginx is not just relying on the DNS, but consciously choosing between two different services.</p>
<p>Let's define the services accordingly in the Docker Compose configuration file</p>
<div class="highlight"><pre><span></span><code>version: &quot;3&quot;
services:
  application1:
    build:
      context: .
      dockerfile: Dockerfile
    command: gunicorn --workers 6 --bind 0.0.0.0:8000 wsgi
    expose:
        - 8000

  application2:
    build:
      context: .
      dockerfile: Dockerfile
    command: gunicorn --workers 3 --bind 0.0.0.0:8000 wsgi
    expose:
        - 8000

  nginx:
    image: nginx
    volumes:
     - ./nginx.conf:/etc/nginx/conf.d/default.conf
    ports:
      - 80:80
    depends_on:
      - application1
      - application2
</code></pre></div>

<p>I basically duplicated the definition of <code>application</code>, but the first service is running now 6 workers, just for the sake of showing a possible difference between the two. Now run <code>docker-compose up -d</code> and <code>docker-compose logs -f nginx</code>. If you refresh the page on the browser multiple times you will see something like</p>
<div class="highlight"><pre><span></span><code>$ docker-compose logs -f nginx
Attaching to service_nginx_1
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:25 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:25 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET /favicon.ico HTTP/1.1 <span class="m">404</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:30 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.3:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:31 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:32 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:33 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:33 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.3:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:34 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:34 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:35 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.2:8000: GET / HTTP/1.1 <span class="m">200</span>
nginx_1         <span class="p">|</span> <span class="o">[</span><span class="m">14</span>/Feb/2020:11:03:35 +0000<span class="o">]</span> localhost to: <span class="m">172</span>.18.0.3:8000: GET / HTTP/1.1 <span class="m">200</span>
</code></pre></div>

<p>where you can clearly notice the load balancing between <code>172.18.0.2</code> (<code>application1</code>) and <code>172.18.0.3</code> (<code>application2</code>) in action.</p>
<p>I will not show here an example of reverse proxy or HTTPS to prevent this post to become too long. You can find resources on those topics in the next section.</p>
<h3 id="43-resources">4.3 Resources<a class="headerlink" href="#43-resources" title="Permanent link">&para;</a></h3>
<p>These resources provide more detailed information on the topics discussed in this section</p>
<ul>
<li>Docker Compose <a href="https://docs.docker.com/compose/">official documentation</a></li>
<li>nginx <a href="http://nginx.org/en/docs/">documentation</a>: in particular the sections about <a href="http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format">log_format</a> and <a href="http://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream">upstream</a> directives</li>
<li>How to <a href="https://docs.nginx.com/nginx/admin-guide/monitoring/logging/">configure logging</a> in nginx</li>
<li>How to <a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/">configure load balancing</a> in nginx</li>
<li><a href="https://docs.nginx.com/nginx/admin-guide/security-controls/terminating-ssl-http/">Setting up an HTTPS Server</a> with nginx and <a href="https://www.humankode.com/ssl/create-a-selfsigned-certificate-for-nginx-in-5-minutes">how to created self-signed certificates</a></li>
<li>How to <a href="https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/">create a reverse proxy</a> with nginx, the documentation of the <a href="http://nginx.org/en/docs/http/ngx_http_core_module.html#location"><code>location</code></a> directive and <a href="https://www.digitalocean.com/community/tutorials/understanding-nginx-server-and-location-block-selection-algorithms">some insights</a> on the location choosing algorithms (one of the most complex parts of nginx)</li>
<li>The source code of this example is available <a href="https://github.com/lgiordani/dissecting-a-web-stack-code/tree/master/4_the_web_server">here</a></li>
</ul>
<h3 id="44-issues">4.4 Issues<a class="headerlink" href="#44-issues" title="Permanent link">&para;</a></h3>
<p>Well, finally we can say that the job is done. Now we have a production-ready web server in front of our multi-threaded web framework and we can focus on writing Python code instead of dealing with HTTP headers.</p>
<p>Using a web server allows us to scale the infrastructure just adding new instances behind it, without interrupting the service. The HTTP concurrent server runs multiple instances of our framework, and the framework itself abstracts HTTP, mapping it to our high-level language.</p>
<h2 id="bonus-cloud-infrastructures">Bonus: cloud infrastructures<a class="headerlink" href="#bonus-cloud-infrastructures" title="Permanent link">&para;</a></h2>
<p>Back in the early years of the Internet, companies used to have their own servers on-premise, and system administrators used to run the whole stack directly on the bare operating system. Needless to say, this was complicated, expensive, and failure-prone.</p>
<p>Nowadays "the cloud" is the way to go, so I want to briefly mention some components that can help you run such a web stack on AWS, which is the platform I know the most and the most widespread cloud provider in the world at the time of writing.</p>
<h3 id="elastic-beanstalk">Elastic Beanstalk<a class="headerlink" href="#elastic-beanstalk" title="Permanent link">&para;</a></h3>
<p>This is the entry-level solution for simple applications, being a managed infrastructure that provides load balancing, auto-scaling, and monitoring. You can use several programming languages (among which Python and Node.js) and choose between different web servers like for example Apache or nginx. The components of an EB service are not hidden, but you don't have direct access to them, and you have to rely on configuration files to change the way they work. It's a good solution for simple services, but you will probably soon need more control.</p>
<p><a href="https://aws.amazon.com/elasticbeanstalk">Go to Elastic Beanstalk</a></p>
<h3 id="elastic-container-service-ecs">Elastic Container Service (ECS)<a class="headerlink" href="#elastic-container-service-ecs" title="Permanent link">&para;</a></h3>
<p>With ECS you can run Docker containers grouping them in clusters and setting up auto-scale policies connected with metrics coming from CloudWatch. You have the choice of running them on EC2 instances (virtual machines) managed by you or on a serverless infrastructure called Fargate. ECS will run your Docker containers, but you still have to create DNS entries and load balancers on your own. You also have the choice of running your containers on Kubernetes using EKS (Elastic Kubernetes Service).</p>
<p><a href="https://aws.amazon.com/ecs/">Go to Elastic Container Service</a></p>
<h3 id="elastic-compute-cloud-ec2">Elastic Compute Cloud (EC2)<a class="headerlink" href="#elastic-compute-cloud-ec2" title="Permanent link">&para;</a></h3>
<p>This is the bare metal of AWS, where you spin up stand-alone virtual machines or auto-scaling group of them. You can SSH into these instances and provide scripts to install and configure software. You can install here your application, web servers, databases, whatever you want. While this used to be the way to go at the very beginning of the cloud computing age I don't think you should go for it. There is so much a cloud provider can give you in terms of associated services like logs or monitoring, and in terms of performances, that it doesn't make sense to avoid using them. EC2 is still there, anyway, and if you run ECS on top of it you need to know what you can and what you can't do.</p>
<p><a href="https://aws.amazon.com/ec2/">Go to Elastic Compute Cloud</a></p>
<h3 id="elastic-load-balancing">Elastic Load Balancing<a class="headerlink" href="#elastic-load-balancing" title="Permanent link">&para;</a></h3>
<p>While Network Load Balancers (NLB) manage pure TCP/IP connections, Application Load Balancers are dedicated to HTTP, and they can perform many of the services we need. They can reverse proxy through rules (that were recently improved) and they can terminate TLS, using certificates created in ACM (AWS Certificate Manager). As you can see, ALBs are a good replacement for a web server, even though they clearly lack the extreme configurability of a software. You can, however, use them as the first layer of load balancing, still using nginx or Apache behind them if you need some of the features they provide.</p>
<p><a href="https://aws.amazon.com/elasticloadbalancing/">Go to Elastic Load Balancing</a></p>
<h3 id="cloudfront">CloudFront<a class="headerlink" href="#cloudfront" title="Permanent link">&para;</a></h3>
<p>CloudFront is a Content Delivery Network, that is a geographically-distributed cache that provides faster access to your content. While CDNs are not part of the stack that I discussed in this post I think it is worth mentioning CF as it can speed-up any static content, and also terminate TLS in connection with AWS Certificate Manager.</p>
<p><a href="https://aws.amazon.com/cloudfront/">Go to CloudFront</a></p>
<h2 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h2>
<p>As you can see a web stack is a pretty rich set of components, and the reason behind them is often related to performances. There are a lot of technologies that we take for granted, and that fortunately have become easier to deploy, but I still believe a full-stack engineer should be aware not only of the existence of such layers, but also of their purpose and at least their basic configuration.</p>
<h2 id="feedback">Feedback<a class="headerlink" href="#feedback" title="Permanent link">&para;</a></h2>
<p>Feel free to reach me on <a href="https://twitter.com/thedigicat">Twitter</a> if you have questions. The <a href="https://github.com/TheDigitalCatOnline/thedigitalcatonline.github.com/issues">GitHub issues</a> page is the best place to submit corrections.</p>
  </div>


  <section>
    <header>
      <h2>Related Posts</h2>
    </header>
    <div class="paginated-posts">
      <div class="posts">
	<article class="card">
          <a href="/blog/2020/07/05/flask-project-setup-tdd-docker-postgres-and-more-part-1/">
            <img src="/images/flask-project-setup-tdd-docker-postgres-and-more-part-1.jpg" alt="flask-project-setup-tdd-docker-postgres-and-more-part-1" />
          </a>
          <div class="body">
            <a href="/blog/2020/07/05/flask-project-setup-tdd-docker-postgres-and-more-part-1/"><h2>Flask project setup: TDD, Docker, Postgres and more - Part 1</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/aws/" class="tag">AWS</a>
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/docker/" class="tag">Docker</a>
		<a href="/categories/flask/" class="tag">Flask</a>
		<a href="/categories/http/" class="tag">HTTP</a>
		<a href="/categories/postgres/" class="tag">Postgres</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/testing/" class="tag">testing</a>
		<a href="/categories/www/" class="tag">WWW</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2020-07-05T13:00:00+01:00">Jul 5, 2020</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2021-08-22T10:00:00+00:00">Aug 22, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2020/07/06/flask-project-setup-tdd-docker-postgres-and-more-part-2/">
            <img src="/images/flask-project-setup-tdd-docker-postgres-and-more-part-2.jpg" alt="flask-project-setup-tdd-docker-postgres-and-more-part-2" />
          </a>
          <div class="body">
            <a href="/blog/2020/07/06/flask-project-setup-tdd-docker-postgres-and-more-part-2/"><h2>Flask project setup: TDD, Docker, Postgres and more - Part 2</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/aws/" class="tag">AWS</a>
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/docker/" class="tag">Docker</a>
		<a href="/categories/flask/" class="tag">Flask</a>
		<a href="/categories/http/" class="tag">HTTP</a>
		<a href="/categories/postgres/" class="tag">Postgres</a>
		<a href="/categories/pytest/" class="tag">pytest</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/testing/" class="tag">testing</a>
		<a href="/categories/www/" class="tag">WWW</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2020-07-06T13:00:00+01:00">Jul 6, 2020</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2021-02-23T20:00:00+00:00">Feb 23, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2020/07/07/flask-project-setup-tdd-docker-postgres-and-more-part-3/">
            <img src="/images/flask-project-setup-tdd-docker-postgres-and-more-part-3.jpg" alt="flask-project-setup-tdd-docker-postgres-and-more-part-3" />
          </a>
          <div class="body">
            <a href="/blog/2020/07/07/flask-project-setup-tdd-docker-postgres-and-more-part-3/"><h2>Flask project setup: TDD, Docker, Postgres and more - Part 3</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/aws/" class="tag">AWS</a>
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/docker/" class="tag">Docker</a>
		<a href="/categories/flask/" class="tag">Flask</a>
		<a href="/categories/http/" class="tag">HTTP</a>
		<a href="/categories/postgres/" class="tag">Postgres</a>
		<a href="/categories/pytest/" class="tag">pytest</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/testing/" class="tag">testing</a>
		<a href="/categories/www/" class="tag">WWW</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2020-07-07T13:00:00+01:00">Jul 7, 2020</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2021-02-23T20:00:00+00:00">Feb 23, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2020/11/04/public-key-cryptography-ssl-certificates/">
            <img src="/images/public-key-cryptography-ssl-certificates.jpg" alt="public-key-cryptography-ssl-certificates" />
          </a>
          <div class="body">
            <a href="/blog/2020/11/04/public-key-cryptography-ssl-certificates/"><h2>Public key cryptography: SSL certificates</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/algorithms/" class="tag">algorithms</a>
		<a href="/categories/cryptography/" class="tag">cryptography</a>
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/ssl/" class="tag">SSL</a>
		<a href="/categories/ssh/" class="tag">SSH</a>
		<a href="/categories/rsa/" class="tag">RSA</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/www/" class="tag">WWW</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2020-11-04T23:00:00+01:00">Nov 4, 2020</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2018/04/25/rsa-keys/">
            <img src="/images/rsa-keys.jpg" alt="rsa-keys" />
          </a>
          <div class="body">
            <a href="/blog/2018/04/25/rsa-keys/"><h2>Public key cryptography: RSA keys</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/algorithms/" class="tag">algorithms</a>
		<a href="/categories/cryptography/" class="tag">cryptography</a>
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/ssl/" class="tag">SSL</a>
		<a href="/categories/ssh/" class="tag">SSH</a>
		<a href="/categories/rsa/" class="tag">RSA</a>
		<a href="/categories/python/" class="tag">Python</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2018-04-25T13:00:00+01:00">Apr 25, 2018</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2022-01-23T11:00:00+00:00">Jan 23, 2022</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2021/06/03/public-key-cryptography-openssh-private-keys/">
            <img src="/images/public-key-cryptography-openssh-private-keys.jpg" alt="public-key-cryptography-openssh-private-keys" />
          </a>
          <div class="body">
            <a href="/blog/2021/06/03/public-key-cryptography-openssh-private-keys/"><h2>Public key cryptography: OpenSSH private keys</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/algorithms/" class="tag">algorithms</a>
		<a href="/categories/cryptography/" class="tag">cryptography</a>
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/ed25519/" class="tag">ed25519</a>
		<a href="/categories/rsa/" class="tag">RSA</a>
		<a href="/categories/ssh/" class="tag">SSH</a>
		<a href="/categories/ssl/" class="tag">SSL</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2021-06-03T14:00:00+01:00">Jun 3, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2022/02/19/from-docker-cli-to-docker-compose/">
            <img src="/images/from-docker-cli-to-docker-compose.jpg" alt="from-docker-cli-to-docker-compose" />
          </a>
          <div class="body">
            <a href="/blog/2022/02/19/from-docker-cli-to-docker-compose/"><h2>From Docker CLI to Docker Compose</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/devops/" class="tag">devops</a>
		<a href="/categories/docker/" class="tag">Docker</a>
		<a href="/categories/infrastructure/" class="tag">infrastructure</a>
		<a href="/categories/postgres/" class="tag">Postgres</a>
		<a href="/categories/python/" class="tag">Python</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2022-02-19T15:00:00+01:00">Feb 19, 2022</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2022-03-17T10:00:00+00:00">Mar 17, 2022</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2021/03/22/aws-log-insights-as-cloudwatch-metrics-with-python-and-terraform/">
            <img src="/images/aws-log-insights-as-cloudwatch-metrics-with-python-and-terraform.jpg" alt="aws-log-insights-as-cloudwatch-metrics-with-python-and-terraform" />
          </a>
          <div class="body">
            <a href="/blog/2021/03/22/aws-log-insights-as-cloudwatch-metrics-with-python-and-terraform/"><h2>AWS Log Insights as CloudWatch metrics with Python and Terraform</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/aws/" class="tag">AWS</a>
		<a href="/categories/infrastructure/" class="tag">infrastructure</a>
		<a href="/categories/lambda/" class="tag">Lambda</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/terraform/" class="tag">Terraform</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2021-03-22T17:00:00+01:00">Mar 22, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/">
            <img src="/images/clean-architectures.jpg" alt="clean-architectures" />
          </a>
          <div class="body">
            <a href="/blog/2016/11/14/clean-architectures-in-python-a-step-by-step-example/"><h2>Clean architectures in Python: a step-by-step example</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/pytest/" class="tag">pytest</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/architectures/" class="tag">architectures</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2016-11-14T19:00:00+00:00">Nov 14, 2016</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2021-09-24T12:00:00+00:00">Sep 24, 2021</time></p>
	    </div>
          </div>
	</article>
	<article class="card">
          <a href="/blog/2018/12/20/cabook/">
            <img src="/images/cabook.jpg" alt="cabook" />
          </a>
          <div class="body">
            <a href="/blog/2018/12/20/cabook/"><h2>Clean Architectures in Python: the book</h2></a>
	    <div class="info">
	      <p class="tags">
		<a href="/categories/oop/" class="tag">OOP</a>
		<a href="/categories/python/" class="tag">Python</a>
		<a href="/categories/python2/" class="tag">Python2</a>
		<a href="/categories/python3/" class="tag">Python3</a>
		<a href="/categories/tdd/" class="tag">TDD</a>
		<a href="/categories/testing/" class="tag">testing</a>
		<a href="/categories/architectures/" class="tag">architectures</a>
              </p>
	      <p><i class="fas fa-calendar-alt"></i> <time datetime="2018-12-20T08:00:00+01:00">Dec 20, 2018</time></p>
	      <p><i class="fas fa-edit"></i> Updated on <time datetime="2021-08-22T08:00:00+00:00">Aug 22, 2021</time></p>
	    </div>
          </div>
	</article>
      </div>
    </div>
  </section>
  
</div>

      </div>
    </div>
    <script src="/theme/js/packed.js?46a8f903"></script>

  </body>
</html>